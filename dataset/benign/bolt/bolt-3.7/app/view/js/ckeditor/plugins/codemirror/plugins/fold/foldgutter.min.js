!function(o){"object"==typeof exports&&"object"==typeof module?o(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],o):o(CodeMirror)}(function(r){"use strict";r.defineOption("foldGutter",!1,function(o,t,e){e&&e!=r.Init&&(o.clearGutter(o.state.foldGutter.options.gutter),o.state.foldGutter=null,o.off("gutterClick",d),o.off("change",u),o.off("viewportChange",p),o.off("fold",s),o.off("unfold",s),o.off("swapDoc",u)),t&&(o.state.foldGutter=new n(function(o){!0===o&&(o={});null==o.gutter&&(o.gutter="CodeMirror-foldgutter");null==o.indicatorOpen&&(o.indicatorOpen="CodeMirror-foldgutter-open");null==o.indicatorFolded&&(o.indicatorFolded="CodeMirror-foldgutter-folded");return o}(t)),f(o),o.on("gutterClick",d),o.on("change",u),o.on("viewportChange",p),o.on("fold",s),o.on("unfold",s),o.on("swapDoc",u))});var a=r.Pos;function n(o){this.options=o,this.from=this.to=0}function l(o,t){for(var e=o.findMarks(a(t,0),a(t+1,0)),r=0;r<e.length;++r)if(e[r].__isFold&&e[r].find().from.line==t)return e[r]}function c(o){if("string"!=typeof o)return o.cloneNode(!0);var t=document.createElement("div");return t.className=o+" CodeMirror-guttermarker-subtle",t}function i(n,o,t){var i=n.state.foldGutter.options,f=o,d=n.foldOption(i,"minFoldSize"),u=n.foldOption(i,"rangeFinder");n.eachLine(o,t,function(o){var t,e,r=null;l(n,f)?r=c(i.indicatorFolded):(t=a(f,0),(e=u&&u(n,t))&&e.to.line-e.from.line>=d&&(r=c(i.indicatorOpen))),n.setGutterMarker(o,i.gutter,r),++f})}function f(o){var t=o.getViewport(),e=o.state.foldGutter;e&&(o.operation(function(){i(o,t.from,t.to)}),e.from=t.from,e.to=t.to)}function d(o,t,e){var r,n,i=o.state.foldGutter;!i||e==(r=i.options).gutter&&((n=l(o,t))?n.clear():o.foldCode(a(t,0),r.rangeFinder))}function u(o){var t,e=o.state.foldGutter;e&&(t=e.options,e.from=e.to=0,clearTimeout(e.changeUpdate),e.changeUpdate=setTimeout(function(){f(o)},t.foldOnChangeTimeSpan||600))}function p(t){var o,e=t.state.foldGutter;e&&(o=e.options,clearTimeout(e.changeUpdate),e.changeUpdate=setTimeout(function(){var o=t.getViewport();e.from==e.to||20<o.from-e.to||20<e.from-o.to?f(t):t.operation(function(){o.from<e.from&&(i(t,o.from,e.from),e.from=o.from),o.to>e.to&&(i(t,e.to,o.to),e.to=o.to)})},o.updateViewportTimeSpan||400))}function s(o,t){var e,r=o.state.foldGutter;!r||(e=t.line)>=r.from&&e<r.to&&i(o,e,e+1)}});