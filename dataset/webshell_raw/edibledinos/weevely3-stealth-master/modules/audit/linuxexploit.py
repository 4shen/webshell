import subprocess
import os

from core.vectors import PhpCode, ShellCmd, ModuleExec, Os
from core.colors import yellow, bold
from core.module import Module


class Linuxexploit(Module):
    """Suggest linux exploit"""

    def init(self):

        self.register_info(
            {
                'author': [
                    'Sander Ferdinand'
                ],
                'license': 'GPLv3'
            }
        )

    def run(self):
        uname = ShellCmd("""uname -a""").run().strip()
        _uname = ShellCmd("""uname -srv""").run().strip()
        if not uname:
            return

        path = os.path.dirname(os.path.realpath(__file__))
        output = subprocess.check_output(['bash', '-c', "%s/linux-exploit/linux-exploit.sh" % path, "-u", uname])

        lines = [bold(yellow(_uname))]
        for line in output.split("\n"):
            if line.startswith("[+]"):
                line = line.replace("\n", "")
                lines.append(line)

        return "\n".join(lines)
